const input = `...........................775.651...............887....79...946...921...493.....942..942.....151....155....................................\n......240...................*.....-......................$..*...................*.......%.....+....................956.549.*290.......834...\n.485...+............437......906......%..608.805.725..72.....242....745..61......440................................*..*.........515...*....\n..........917.......&....146........790.....*......*....*..........*.....*...............207*......................796..116......../...924..\n722...323.-................./...410.............72..748.442............384.708...............849..%............................470..........\n.....*..........................*.....271..691....-...............4*...........388.................448......&........*....848&......751.....\n....370..$....639.748.......*...467....*.....*........921*909.....................*...32.....................165..452.30....................\n........984....*.....*...782........711.....50.172...............61&..........415.803.*.........524.......................203.......106*643.\n...............57..433.........390....................&../.............*122...........674.........*.........................................\n379..................../.........*........908..477...305.876..*..............297.415*......+.......94........../.....@378.......226..56*....\n...*..-......82.......167...936.17..958...=....*...............196......+......*.......-...380.992.............989.........29......*....301.\n..124..317.....*....................*..........839.......................191.882......231.........+......976.................+......469.....\n............643................*........778............541........655..............*............*........./............*.................515\n.....&............498#...&....726.774..............111....*378..................723.221.......473............752....523.638.......789...*...\n.....353................518..........-.........../....*...............*88.........................*..@280..=..-....................-..297...\n...........279...........................*816.....286.975.&319.....614......694.......799.......503.......861...569.............+...........\n..474........*.228..............308......................................................*............207........................838..408...\n...........226./....*................82.........................268/......814.........640.............../..489........719..=..........*.....\n....83............88.544....250.......=...87..............199.........115*....................................*...377.@.....643........658..\n........-...651.............*................&..............................*379.....411...686.397............202.*....../........217.......\n.....781.......*897......630................330.....117.961..........61..543.....#...*.....*.......323.............996.603.......*..........\n.......................................................*........473....*.....739.184.511..........+......43.833.................953...@.....\n....110......@471...........*464....@.347......779................/.....205.*.......................681.....@.........................694...\n.........................203......158.-....310./...449...726*982.............437.....+....259...................185......940*702............\n.....465....*.......747....................*..........*...............................238..&......./..963...755....*........................\n.....*....687..104..%.........645........959..497..732........988........733.....12...........417.176....$..........176.323....657..........\n...566........*...........938*......418......*............925....*28..............-.156........*................................*..#........\n.............933.......................*....988........../............................*........813.................868*674...375...839......\n.....................804.......464..452...................................47......324.789..........692*288..................................\n...959...........792....*10.....=......................*455.77...827.99....*.........................................166.......8...586......\n.....*...607......*..............................12.764......*.......*..905....590.236...#.677...823......972..204............*......*......\n..661....*........776....938..901.............@.*.........$...216...995...........*....382..*....#....546*.....#...........564........707...\n......755................*.......*698......315..291.......964................-.......=.....865........................521........150........\n........................323............./............973.........*35..........318.....204...........546..+667....214%..*..............973...\n........143......&725...........619....149..............*235..650.........604..........................*..............195..............*....\n................................*.................................926...................@240......+...433..302..672.........977....149..335.\n.......880.......&...............301.512.$.....876......331.897...#..............#...............464......+...........938.........*.........\n......@....942...603....&....879..........117..........*.....*.............562..905....377*862..............*56.........%........352..*165..\n.726......*..........239....*.....915..............@...661...905..............*...................466....223.................730............\n....*......97..839.......308.........*....115....512..........................497.392.....563........=...............448...........462*884..\n....122.........*...471*...........52...&..=...................=..................@.........*...............................531.............\n.........*..522...&.....274...........116......*572...........907..........................161..670@..@....................=........57*.....\n.........28.*.....606.......................925...............................908...86...............78..............712.....813*......16...\n....549.....512....................................825.....797.......224..660*........@.425*656.........=536..256.......*........599........\n...*.............963..................842..704.............+....425..*..............................102.......$....565.179..774/........576.\n...................*..........................*..............=...*....922........50...262....%............603......*........................\n.......636.......349...&...224...$............899.........983..319.............#........&...663....*575..%.......95.....383*................\n......=...............928........218................84.............964.........953..+...........212.........................857.............\n............................179.......68......................&....*.................787.............92&.72....455..969...........846..40...\n.993=..../..........110.407*...........%.............164..#....306.215...................552..............*....=...#.....69.602...#...*.....\n......322..........#...........561..............968..*....913............%..........@586...=.330...........166.............*........863.....\n............810...........157.*....557.....30.*.....774...................968.601*...........*....491..........557.....83*..................\n.......*368.*.......842...*...435.-...........65.-................................680.....913....#.......793....*.........87.262....34.-....\n....896......875.....*...........................581.957..758............$................................@..981..............#......*.844..\n..................957...150.......503................@....*......89....59......261..........653....................................372......\n...731...-129..+........*........-......................718.713....*.......197..*......30......+...476............872.......................\n....*...........671....917.......................800.&......=....197..763....*...96......#.........*......%......*..........739......290....\n.....234..............................814*251....../.755.............../...375.....................309.914..816...877..=.......$......$.....\n.........543.378.....74.%608.25...755..........237..............834..................431..................../..........585..................\n....408...&...*..............*................*.............214*.....................*.........89.475*.......................@..939..824....\n...*..........526..........713..&.....132...899..108.75..#..................521....428....97../.......603.....248.........878...&...*.......\n....383...............873......1....................*....850....862....%......#.=................533.........*.......................863....\n.............852.........*................578%....................*..492.........905.145.927........*........437.107.....@....29............\n......604.......#./531.179..&........56.........921..233.......943......................*..........174...........*.......271.*...32.........\n........*..619.............588......*............*...*..............918*837.....120.128......508...........536...............558...*638.....\n523....794...-....................451..544....648..365.778.....@.............@.....*............$..%414...*............453#.................\n..................&......124*...........*...............*...259........696...424...........*...............322..534................*519.....\n........201*.30...474........567.526..363............%.963......287+......*.........939.964.....994.............*.....-........287.......657\n........................709*......=.........854...527................50..591...859....%..........*....196.......188..395..157...*...........\n.281*....878................354.......*221...*............308....309...*.........$..@...72#......577.........................*...734.....481\n.....9....*.............658........235......767..12..548...=...#.......585..830....609........................603.130.....884...........*...\n........324........@...*........................*....*........628.............................................*...$...........=......658....\n..................139.206....$.....768*........986....311..........967...15...174....100-.....7$..............962....=.........561..........\n......521.....154.............318......622...................-.............%...@.................856.......60.........24..481.......520.772.\n.825..#.......*.............................180.............228.11.....173.......128......428.........405.+...68...........=..882......*....\n....*.......657...........27....798*460...................@............-..............31.*.....840...........*................@.............\n.965...931............974...*...........................798.................455*.........856......*...809...97..934.740$..570...............\n........*..511.$427....../..652..-297............296........$........552..........884..................*........%........*........128.......\n..........-..........207............................=....641.........+..........-..*....43..........329................990...........*......\n.10...................=..11....&............................./.143........875..732....&.......&............................349.....265...858\n...*......222....495%...*...618..322.......%.........116...833....*........*.........776....288....760.........-............-...............\n....291......*..........453.........*...811...398..............515........365..445....................*.....961.........433......743...$....\n.............33..................543.........@..........................=...../.....793*...........266..............668...........#.....804.\n................701....................17*.................449*741.....961......814..........................*245......*...809*.............\n.......206......*....668..728$............529..........*93........................-...833.713..............69.......292........157...224*...\n..........*585...969............810..522............866..............254.....570........*....*.....588..................+113.......-.....752\n................................/......../......257.............119...-..844...*..979..442....169.....=.259......+.............752..401.....\n...726...967........&.234.................326.....*....590*636...*............130.../.........................933.....652*439...*...........\n.....*......*12..332...-...........500#..........944..............747.......$.....................203....513.......................%864.....\n....389.&....................*...............938.......893....970.........864........538.755&.258..*........#...............717.96......+...\n.65.....180...&.............864.....169.........*................*...390............*.........*....904.........................*...354...478\n....620......472.726.931...............*.......150../.......@....960....................*928.812...........................428......*.......\n...*................*.................463..........323.....478..........964..........175.........324%........=827......66.......193..303....\n313.......................@...705.214.....174&........................-.....271........................818...............*.........+........\n........171+..830...328..158...*..%..................17....721.....568......../...........949.............*.............608.....90......570.\n....327..........*....*.......44......................*..................193-.......67.................970......966.503................#....\n669*..........386..306....+............105............443...........................*........490..130...........*....$..........$62.........\n......454...............&..954...38....*..........229....................643......388.671....@.......*...8......506....66*148.........$.....\n......*................259.........*.................*756.......596.........*........................638..+....................%....854.....\n...700......895..............................757................*.........847..............630*612..................854..606....38..........\n...............*.....93.....573......274........*...952..336...................562..................+...637............*.*..................\n945........../.814..=..........*....*...........38..=............-....&........*..................118......*.........745..855.........367...\n......676..688..................604..153...............671......513...690....891.%.....101.728..........767......28...................../...\n.........=.......700..222.443............114.....................................458...../....#...................*.........=...............\n...........660.%...&.....*.....98.232.......*............308.......650..267/..........$............................417.....806.....502......\n.......276*....500............@.............63.......621*.....520...-........913.....225.........620.597...709*632.............663*.........\n...................232...149............65.......................&........................228.....%.....-................467............800.\n..........118........+....*....@.........-.458...737.....-247.........425................/..................574......424*.........421..*....\n......158.-....*........564.599......128......*...#..........................419.............764*156.............................*......996.\n............577.563.....................*...777.......................508..............*827............................*465.....306.........\n.........................*..............848......996*......688....154...*.......%...780......51...410......357.148..856.....................\n...648.............835.713....*...609.......................&........*..885....494..........*..........661....*.............................\n...-.....477./693..*........938.....*./...........642..149......465.502......$............=.523.........#.......892................=824.....\n....................296...........44...707..........+.....*...................462......476........@...............*..........388............\n.....58...321..............127................................446...............................965....446........114.........*.............\n.........*........951...3....*.................623.263.............=.-....122..........................=....519*...........692.......%313...\n........943.......*......$....990.......795..../......*..135.....815.483....*..937*.............................634..............771........\n............460....757.....@......511/..*............564..-..............340.......109.206.......%785..148...21....................*....&...\n.47.........&...............102........265......555..................182......12*.........................*...%.................788..200....\n.../............=..................#82..........$.......207.............*863.....751.........251.....641.702.......141..640.................\n..........23..902.......174...............*.............=.....314...........................*..........*.....*667...........*...............\n.........*...............*.......*766..842.35.......243..........*......@..................57..435....501.285.............964.....*.........\n..165...100.@512.........292.......................%......79..@...726....341.511*.............*...................573..........602.74.......\n...*..................................596#...&...............769........................314.397..&31................%..855..................\n...6.....673....................898..........836.......827.......+.....-..............................133*766..........*..............290...\n..........*.........799........*.........629.......634........%.188.103.......594......464.799*295.............895...930.........-....$.....\n.....908..504.......*......603..800..936...*......*.........768..........973...*.......*...............904*16.*................358..........\n.....@............825..%......&.........*...963.294.74...........%........*....102...967...-343.................#..................94.698...\n.810...................968..............429...........*....950..313..482..397...................33.........@..297..198...114.......*...*....\n.....-............................554..................................-.......245.$...............991..282.........-...*....161..894..78...\n..705.....177.....*..872@.285........*.../813.........235....729..........*287..*...472.788.645........................144..................\n.............*..984.......*........722............496*..........*990....79......715........*............456...................812..470......\n............518......@.....950.........712..............981...........................238....579.533........373.466...615/......$.....*907..\n..716..907.......761..471..............*......../...........823..+............978*......=.....*.....#......&....*...........................\n....*...............*........990.331...46....871...........*.....447.723...@...............594...............801......................#757..\n...312...*.........211..........*.................90.860...970.........*...375...........*.....-....*779.........&..........................\n.......692..............602.............................*.............595.............841...166..327......-444....154.......................\n..............$....316..=.............+978.843........42....135/.+332.........454.........................................707.../......295..\n.........$....743..../.......-................+........................*990..................343......#.....*...............*....684........\n......651.....................644....................887.812........187.................783........749...928.291...........131...........293`;

function inputToMatrix(input) {
  const data = input.split('\n');
  const rows = data.length;
  const cols = data[0].length;
  const matrix = Array.from({length: rows}, () => Array(cols));
  for (let row = 0; row < rows; row++) {
    for (let col = 0; col < cols; col++) {
      matrix[row][col] = {
        value: data[row][col],
        validPartPlace: false,
      };
    }
  }
  return matrix;
}

const matrix = inputToMatrix(input);

//Part 1
function isDigit(c) {
  return c >= '0' && c <= '9';
}

function isSymbol(c) {
  return c != '.' && !isDigit(c);
}

function getMooreNeighboorhoodRowCol(row, col) {
  return [
    {row: row - 1, col: col    }, // north
    {row: row - 1, col: col + 1}, // north-east
    {row: row    , col: col + 1}, // east
    {row: row + 1, col: col + 1}, // south-east
    {row: row + 1, col: col    }, // south
    {row: row + 1, col: col - 1}, // south-west
    {row: row    , col: col - 1}, // west
    {row: row -1 , col: col - 1}, // north-west
  ].filter(c => isValidRowCol(c.row, c.col));
}

function isValidRowCol(row, col) {
  return row >= 0 && row < matrix.length && col >= 0 && col < matrix[0].length;
}


for (let row = 0; row < matrix.length; row++) {
  for (let col = 0; col < matrix[0].length; col++) {
    const value = matrix[row][col].value
    if (isSymbol(value)) {
      const neighboors = getMooreNeighboorhoodRowCol(row, col);
      // mark neighboors as valid part emplacement
      for (const {row, col} of neighboors) {
        matrix[row][col].validPartPlace = true;
      }
    }
  }
}

let currentDigits = '';
let isNumbersIsInAValidPartPlace = false;
let sum = 0;
let currentCells = [];
for (const cell of [...matrix.flat(), '.']) {
  if (isDigit(cell.value)) {
    currentDigits += cell.value;
    currentCells.push(cell);
    if (cell.validPartPlace) {
      isNumbersIsInAValidPartPlace = true;
    }
  } else {
    if (isNumbersIsInAValidPartPlace) {
      sum += parseInt(currentDigits);
      for (const c of currentCells) {
        c.id = sum;
        c.nbValue = parseInt(currentDigits);
      }
    }
    currentDigits = '';
    isNumbersIsInAValidPartPlace = false;
    currentCells = [];
  }
}

console.log(sum);

//part 2
function isGear(c) {
  return c == '*';
}


let sumPart2 = 0;
for (let row = 0; row < matrix.length; row++) {
  for (let col = 0; col < matrix[0].length; col++) {
    const value = matrix[row][col].value
    if (isGear(value)) {
      const neighboors = getMooreNeighboorhoodRowCol(row, col);
      const partsNeighboors = new Map();
      for (const {row, col} of neighboors) {
        const c = matrix[row][col];
        if (isDigit(c.value)) {
          partsNeighboors.set(c.id, c.nbValue);
        }
      }
      if (partsNeighboors.size == 2) {
        let gearRatios = 1;
        for (const nb of partsNeighboors.values()) {
          gearRatios *= nb;
        }
        sumPart2 += gearRatios;
      }
    }
  }
}

console.log(sumPart2);