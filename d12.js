const input = `.#?#???????.????# 1,2,3,2,1\n?????????? 1,1,4\n????.??.??.??? 1,2\n??????#??????.? 2,4,1,1,1\n?.?#??.?.#####???? 2,9\n???#?.??.???? 3,1,1\n.???????.?# 2,3,2\n?.#????#??.#? 4,3,1\n..?????.??????###?? 1,6\n.####?????#.?.?#? 7,1,2\n#????#????.??????.#? 1,1,5,2,1,2\n.??#?.#???#? 1,1,1,1\n.??#???##.?????? 7,2,1\n????????????.??#???. 1,1,7,1,1\n?????????# 1,5,1\n?#?.#????#????#???? 2,2,1,4,1\n?.??#????### 3,3\n????##??????##??. 1,3,9\n.????????. 1,2\n?#.????#.. 1,2,1\n?.??#????.##??. 1,1,3,1,4\n.??.??#?##?##?? 1,5,2\n?#.?????.?#?? 1,1,2,1\n?#??.?#?#??????#?#? 3,14\n#???##??.?? 8,1\n#?.#??????##?.? 1,1,7,1\n??.#??#??# 1,1,5\n??#???##?###??.??? 13,1,1\n?##????#????? 9,1\n?.??.##?.?? 1,3\n?#??#?.??? 5,1,1\n???#?#?.???#?#?#. 6,8\n??..?#?#????? 2,5,1,1\n#?#?##.??.?#??#?.?? 6,1,5,2\n?.??#.#????????? 1,3,1,1,2\n?.??.????#?.???#??? 1,1,1,3,7\n??###?.??##?#? 5,5\n????#???.???#?? 7,2\n????.?????# 3,1\n#?##??.?.?##??#?#?# 5,1,7,1\n??##.#?.#?..?? 4,1,2,1\n????.???..#?#? 4,2,3\n???????#.????? 1,6,4\n#??????#..?.??.?#??? 3,4,1,1,3,1\n?#?##?..#?? 4,1\n?##???.#???#?#??? 4,1,3,1\n.?#??##?????#? 8,3\n?.?.?????#??????#?? 1,8,3,1\n????#?.??#????. 4,5\n?#..#??????#?.? 1,1,5,1\n??##??#??.?. 2,3\n.??????.#??? 5,3\n????????#??? 2,2,1,1\n..#?#?##???????#?? 8,4\n?????.??????.#?#??? 3,6,1,1,1\n.??.??.#?#.#?????#.# 2,1,1,1,7,1\n..??.????????#??? 1,9\n??.?????#?.???? 1,3,1,3\n???.?.#????? 2,1,3\n.#????????? 1,5,1\n????#??.???#????? 2,8\n????.??.??#???? 2,1,1\n..?.?????? 1,4\n?#?#.#??.?#??#.??? 3,3,4,1,1\n.#..???.?? 1,2\n?.??#??#???# 2,2,1\n##???.??????? 5,1,2\n.#???##??????.??# 1,5,2,1,3\n#.?.??#????? 1,1,3,1\n.??##?#.?#?#??# 5,1,1,1\n?????#?.??.?.?#??? 1,2,2,1,1,1\n??##?????? 1,5,1\n.?.???????#.?? 1,3,1\n..???????#?##?#?? 3,9\n??.?#????????#?..#?? 1,12,1\n..??#?#??..????.? 1,5,3,1\n.#?.?...?.??. 1,1,1\n??#??.?#??????.?? 4,1,1,1\n.#??##??#?? 1,6\n??..#???.???.? 1,1\n???#??..?. 6,1\n??.??.#?????#.?#?? 2,4,2,2\n???..?????.?#??#.?? 1,4,5\n...?#??#??..??#?##? 6,4\n.?#?##?.??.??##??#.. 6,7\n???????#???? 2,4\n#?.#?????#??..??? 1,2,4,3\n?????????#? 1,6,1\n?.?##??.#.? 4,1\n#?????#.?.?#??#??? 1,5,1,1,2,1\n???.?????.#??#.?# 1,4,1,1,1\n..?..?#???..?.?#? 4,1\n##.??????##??#???? 2,1,1,2,1,2\n#?.#????#?#????#? 2,1,3,7\n.?#?##?#????#???? 12,1\n?????????#??? 1,3\n????##?.#?????#. 1,2,2,2\n#.?.????#???.#??#??? 1,1,3,4,5\n?#??#?#.?##.?####? 7,3,4\n????????#?#. 3,2,1,1\n??????#?#??#?? 6,2\n???.????...?? 2,4\n??##???##..?? 5,2\n??#.#?.?#??? 1,2,2,2\n?#????#??#?????? 1,1,2,1,2\n??.?#?#?#??..?????? 6,2\n???????#??.??????#? 1,4,3,2,1,2\n..#??#???##??? 9,1\n???...????? 1,1,2\n??#??..???#???.#? 1,3,1,4,1\n??.#?.???#?#?.? 2,2,1,4,1\n#????##??#..?? 1,5\n.????.?#??? 2,1\n?#?#.?.?.????## 1,1,1,1,2\n???#?????.?#??#.? 4,1,4,1\n?.??.?.?##?? 1,1,1,4\n##??#????#.?..#?# 3,4,1,1,3\n.#..??.??#?? 1,2,3\n????.##.?? 1,2,1\n#..?????????# 1,5,2,1\n?#?#????#?????? 2,1,3,2,1\n?#?.?##?#?? 2,5,1\n??#????.??? 7,1\n?#???#?.?.?.??. 1,4,1,1\n.????##.#.??#??#??? 6,1,1,7\n.???????#?##?? 2,7\n?.?#?#???#?#.??.???. 1,1,1,5,2,3\n????#?#?.?????.# 6,2,1\n???..#??.?..#??.??. 2,1\n?.?.???#?.. 1,3\n?#????..???.?? 3,1,1,1\n#??.?.?#?? 3,1,1\n?????.????? 4,5\n??????????#??#??? 4,1,1,1,4\n??#?.???#??.?????#?# 2,1,4,1,1,1\n###.??.?#???#?? 3,1,6,1\n???##???.?##???##?? 5,8\n..???##???#?.# 6,2,1\n??..???????#???? 1,1,3,1,1\n..????#.???. 1,1,3\n???..??#??#???#??? 2,4,2\n??#??#???????##? 1,1,5,2\n.#??#?###..?????#.. 8,2,1,1\n.?????????? 1,4\n??##???????.##?.?? 5,2\n?###?.????#??##??#?? 5,11,1\n.?##??????? 3,1,2\n.?##???.?#?#?## 4,7\n?????##??? 2,4,1\n????##????#??????? 10,1,1\n????#???#.?..???? 1,1\n#??#????.?.????? 4,1,1,2\n?#?.?.??#?? 1,1,2\n?????.?#?. 4,1\n?.???????.????? 1,1,1,1,2\n?.???..?????#??#.? 3,8\n????#?.??? 3,1\n???#?#??#???##??? 1,12,1\n?#?..#???.?????????? 2,4,8\n?#???#?????#????? 3,1,5,3\n?..?.#???.?##?? 1,1,2\n?.??.??#?#?#?? 1,7\n.?##?#??.?# 5,1\n#??#?##??#?#?. 1,4,2,1\n.????####. 2,5\n????#???????? 7,3\n?#?.?#.????.? 1,2,1,1\n????????????#??? 1,10,1\n.??.???#???????..?? 1,6,1,1,2\n??.??.?????? 1,3,1\n?##?????#???.? 3,2,1,1\n?.??#??.?.????.??.?? 1,4,1,1,1,2\n??##????????#????? 1,2,2,8\n???#??##..?.?? 8,1,1\n??????..?#? 3,1\n??.??????#?#?.?.? 1,6\n?#????#???#?#?.?? 13,2\n#?????#???##??? 8,2\n???.??##.?.. 1,4,1\n?.?????.##???###?#?? 1,10\n?#?.#.?#??????. 1,1,8\n?.???#???.?.#?#?#.? 6,5\n#???#??#???? 1,7\n??###????#?##?#.#?? 12,1,1,1\n????.#.?#???.?.? 1,1,2,2,1\n??????#??????..?? 1,1,8,1\n.??????#??? 2,1,3\n.???.????? 2,1\n.?#?#???#???#?#?.# 4,1,3,1\n##?.???????.??? 2,1,2,2,1\n?????..???? 2,2\n?##?#???????#.? 7,1,1,1\n?#.#???.?.##??###??? 1,1,1,1,10\n???#?#?????????##? 1,1,5,1,1,3\n??.??????. 1,4\n?#??##???# 5,1\n?.??.#?#???????##?? 1,1,3,1,1,4\n??.????#???#?#????? 6,7\n?..#?#?????? 5,1\n??????.??????? 3,4\n???#?#?#??##??? 1,1,1,7\n????#?.?#??.?? 5,3\n???#.#????##???? 3,8,2\n?#?#??.??#.?? 4,3\n##??#???..? 5,1,1\n?##?#.?##? 4,3\n??..?.?#??.?????#?? 4,3\n#????#?##??#?.?.???. 1,7,3,1,1\n?.#?#??##??.#?#?? 8,4\n?#..??#?#? 2,1,2\n????##??#? 1,2,2\n.????#??##??????? 5,3,2,1\n###?????#?.??????? 3,2,1,2\n?.#?.?#?#??#? 1,4,2\n???.????##...?????? 2,3,2\n?#??##??????#? 5,1,1,1\n???#?????? 5,1\n?.###?????#?? 3,5,1\n.???.?????#?.?? 1,6\n.???????.. 1,1\n??????#????#?# 7,1,1,1\n??.???#?????#???. 1,13\n.???#????? 1,4,1\n????#??##.?# 1,1,2,2\n.?#???#???##??..#.# 7,4,1,1\n..????.?????#? 3,3\n??#?#..??? 5,3\n??????????.? 1,6\n?.?#.??..?##??????#? 2,1,8,1\n??...#??????##? 1,2,1,3\n.????.??#.???#?? 1,1,3,1,2\n?#???????? 1,3\n.?#.??#.???#?.? 2,1,3,1\n?#????..????.# 1,2,2,1\n??.?##???#...#?? 6,2\n??#???#????.? 3,2,2\n?????#???#????? 2,6\n.#?.?.#.???? 1,1,1,3\n?###?#??#??#.??? 3,1,1,1,2\n.??##??????#??#??.#? 6,1,1,2,1\n...?????#?##????? 1,1,8\n.#??.###???#? 2,3,3\n?.#?.??????#??##? 1,8\n??#?##????????#? 6,1,2\n??.??#?.######?.?.? 3,7,1\n?#??#????.?????####? 6,1,2,6\n????????#.???#?? 4,2\n.##??#?#???????.?#? 3,1,3,1,1,3\n.??.?????? 2,1,2\n??.???.????. 1,1,1,1\n#?.?#??#???. 1,4\n??#??#????##?? 5,4\n#??????????? 1,2,2\n???.?#??.??#?? 3,3,3\n?????.???? 1,1,2\n?...??.#.????##??? 1,1,1,7\n.????????.? 2,2,1\n?.?#.#?#?????#???? 2,1,3,5\n????.#?.????? 2,1,3\n??.#???.??????##?##? 1,2,1,1,7\n??#?????.??#?#.. 5,4\n.##?#?#??#????.? 6,5\n??..??????#???#.#?? 2,1,1,7,1,1\n#???.??.?? 3,1\n.??#??#??? 4,3\n#????.#??.????? 2,2,1,1,3\n.?#.???.??.??.?. 1,3,1,1,1\n?????#????#? 1,1,1,1\n.??#???.#.? 5,1\n?.??#????#?#??#??#?# 1,4,4,2,1,1\n?.????.???#? 3,4\n??#?.????#???###?#?? 2,2,1,8\n##???.?#?#??? 2,2,1,3\n?.???.?#??? 1,3,1\n??????????? 3,2\n#.??#????## 1,8\n??#?#?.??.?? 1,4,1,1\n??#????#?.#??? 7,4\n?????#????#??#???.? 6,6\n???..#.????#????#.? 1,1,1,2,7,1\n#?###???????????.?. 5,4,1,2,1\n..???##?.???#??#??? 3,7\n.#???#.?#.?.? 2,2,2,1\n##?????????????###?? 4,2,1,2,5\n??.?#??#???? 1,2,1,1\n?.#.??????.?#?##?#? 1,1,2,2,7\n???..????. 1,3\n#????#?.??#?#. 2,3,2,1\n?.?##.???.? 3,1\n??#?#####?##?##.???. 9,5,1,1\n.????????## 3,2\n??#????#.????#????? 3,2,5,1,1\n??.??##??? 2,2,1\n.??#??.??#??#? 4,5\n???????#.?#. 1,1,1,2\n?#.??#?????#??#.?#.? 1,12,2\n?.#???#.?.?. 1,1,1,1\n.????????#?#??#?? 2,8,1\n??..?#?.###? 1,4\n??##????#??.???#? 4,3,1,1,2\n?????.????? 2,3,1\n???#????#????#??? 1,10\n??????##?#???.?????? 6,4\n..??..#?????#?#??? 2,7,1,1\n#?#?????.#?? 1,1,1,1\n?.???#???#??#?? 1,1,10\n?????#?.#...? 5,1,1\n?????.??.????????## 2,1,1,10\n.???.?????. 1,1\n???#?????.?????###. 1,2,2,2,4\n?.??????.??#???? 1,2,1,2,2\n????.????. 2,2\n?.????.?#??????? 1,3,2,4\n.?????#?.??#???? 1,4,1,4\n???.?.??..? 3,2\n?.??#?????? 4,1\n##????#????#. 9,1\n??.????????? 2,3,1\n?#????#.??.?????? 4,1,2,3,1\n????..??#?#? 1,5\n#???###???.????. 1,5,3\n??.???#.????#??#.# 1,4,2,5,1\n.??##?????.?##??. 4,3,3\n??.#.##?.?????? 1,1,2,1,1\n?#.?????????? 1,1,1,3\n?#..??#???#??#?.?#?? 2,4,3,2,2\n?.?..???.#??. 1,2,2\n?.#?#?...?????? 3,5\n.#?.???????. 2,1\n??????.????#?## 1,2,7\n???.????#?????? 3,4,1,1\n.????#?#??.#? 3,4,1\n?.?#??#??#??#.????# 10,1,1\n??.??.??????#? 1,1,4,2\n.#?????#??? 1,5,2\n?.????????? 1,1\n?#?#??????? 6,1\n.#?##?.????????## 5,1,5\n????##?#???????? 5,4\n..?#.#??#?#???#??#?# 2,4,1,1,4,1\n.?##?.?#.??? 3,2,2\n?.??#??##.?##??? 7,3\n?.#????.???? 4,1,1\n#???.??.????##? 2,1,2,1,3\n.##?..????????#?? 2,4,1,2\n????#?#.????? 5,2,1\n???#?.?????#?????#. 3,11\n?????###.#???. 8,1,2\n??.???..?#??#.?.??? 1,1,1,4,1,3\n..???.??.? 1,1,1\n?###???.#???#???# 6,1,2,2\n#?.????..???????? 1,1,1,1,5\n??#???#?.?#??.?#? 7,3,1\n??##?.????#??.????. 5,5,1,1\n?????#??##?#?? 3,8\n.???###??????.??# 8,1\n??##??.???# 4,1\n?.??#?#??#?. 2,5\n#???.#??????. 4,1,1,1\n???#.???#.#??#? 2,3,1,3\n?????##???#.??..# 1,6,1,1,1\n.#?.?#?#????##???? 2,13\n??#????.#??#??#??? 1,1,1,1,7\n.#.?.#?.???. 1,2,2\n?#???#?#?.???#??#??? 8,7\n??????.??? 2,1,3\n#??????.???#? 3,3,1,2\n???.#????? 1,1,1\n???..?##?#?#??.?.# 1,9,1,1\n..????#??#?????? 3,5,1\n.???.??#?????.. 1,6\n?#???#???????# 5,4\n..?#????#?. 2,3\n????#..#??# 4,1,1\n.???##?#????#?#? 1,5,6\n???##??#???#?#..? 7,4\n???#??????#??.?? 6,1,2,1,1\n.???????..??.. 1,5,1\n?????.????# 4,2,1\n.???#??#??#??.? 5,2,1\n??.#?????. 1,1,2\n.?.????.??#.???# 1,1,1,1,4\n??##???.?.????? 4,1,1,1\n.?#?.?????????? 3,2,1,1\n???#???.??##??# 4,1,7\n?????????###????. 7,6\n????..#?????#???? 1,1,4,3\n??#?#?##?????# 3,2,3,1\n???.??????.##.? 2,1,1,2,1\n.???#????? 3,1\n?????.???#???#? 5,2,3\n##????????#???#??##? 2,1,2,4,1,3\n.?.#??????.?. 1,2,1,1\n.?.?#?.??.?# 1,1,1,2\n??#?.???.?? 2,2,1\n??????##.????#???? 1,6,5,2\n.?????.???#??#?#.. 3,9\n?##???#..#?.??? 6,2\n??..??.????#?# 1,1,3,3\n#??#???.?#?? 1,3,1,2\n.#?#.#???? 3,1,2\n?????..???## 2,1,2\n???#??#???.#???#.? 5,1,1,2,1\n?##????.#?#?#??#?.?? 5,1,9,1\n?.?????#?.?##???#?## 4,1,9\n.#???#...??.?. 5,1\n.#??#??#?.#??..#??? 1,6,2,3\n??##..?.##?#??.? 3,1,2,2,1\n?????##????#????.? 9,4\n#?.??????.?. 2,1,3,1\n#???????????????#?. 3,12\n???.?..??#?#?????? 2,7,2\n?#####????#???#??#?? 11,5\n??.?.#????? 1,5\n????#..?#???? 1,1,3\n#????#?.??#..?#.? 6,3,2\n??###???##???..??? 9,1,2\n??..?#?#???????.? 1,7,1,1,1\n?#?.##?##??.#??. 2,5,2\n????????#...? 6,1\n#?????#??##?.?..#??? 7,3,1,1,1\n?#?.????????? 1,7\n#???????#.??? 5,3,1\n?#?#???#.??? 7,2\n??#??.?#????.?? 1,1,1,3,1\n?.#???.??? 1,1,1\n?????.???##?? 1,5\n.??##???.? 6,1\n??.###?##? 1,6\n??.??????#?##. 1,1,1,4\n????.???.?#??##?. 1,6\n?????#??#?#?.#?????? 3,4,2,2\n?????.?.?#? 3,1\n#???#????.?#? 1,2,1,2\n##??.????#??##??? 2,9\n??#???????????.?.??? 1,1,9,1,2\n???#?##?.?##? 8,3\n?.?#?##????????.#.?? 7,2,1,1,1\n?#??????#??#?#?? 2,11\n????.?#?#?#????????. 3,6,5\n????.??#.???..??.. 1,2,1,3,2\n?#.??.?.??.??? 1,1,1,3\n???#??##???.#?#?? 3,3,2,5\n.#??###???? 1,3,1\n.?.????..? 1,1,1\n.?#???#..? 1,1\n###?#?.#?#.???.?? 5,3,1,1\n?.???.####?#?#? 1,4,3\n.#?#?.#???.???? 1,1,2,1,1\n.????????.???? 2,1,2\n??##????#??????#???? 4,12\n?#?????#?????.??? 2,3,6,2\n.????????#??? 1,4\n?????????###??###?? 3,8\n???????#?.? 5,2,1\n###.??.?##??###. 3,1,7\n?????#?#??#???#.? 1,12,1\n.????#????#??#.?? 13,1\n..???????#??.??.?? 4,1\n?????#?#?#???#??? 1,9,1,1\n??##.????.? 4,1,1\n????.??..##????#. 3,1,7\n.??.?#.???. 1,1,1\n??#??#?#?.???# 5,1,1,2\n?####??#???.????#.? 5,3,4\n?#???#????## 7,2\n.#??#??#??.##? 4,2,3\n?.#???#???.?????? 1,2,6\n?..?????#?##???????? 10,3\n?#?.?????###??#????? 3,1,7,2\n??????##??#?#???#.. 2,3,8\n#?#?????#?. 4,1,1\n????#?#?.#.??????? 2,3,1,4\n?????????#??????.? 1,9\n?????#??????? 2,3,1\n#?#??..?##???. 3,5\n???#???...??#??#?? 1,1,1,3,1,1\n#?.???.???? 1,1,4\n##?#??#?###?.??. 4,6,2\n#??????????#?#??. 1,14\n.?#???##???.??.???? 3,3,1,1,1,2\n#?.????#???#?.????? 1,1,4,1,1,1\n#??#?..??#??#. 2,2,6\n??.????????#??.??? 1,1,1,1,3,1\n.?..?????###?. 1,2,4\n??#?#?#?#???#? 8,1\n.#?#??.?#??#?????? 4,8\n?.??###??.?. 5,1\n???##????.#? 1,4,1,1\n??.???.??????.? 3,4\n?.????.??#? 3,3\n??#??##?.#?.? 1,3,2,1\n??#?????????#?? 4,4,1\n?#??????.##????. 2,1,1,2,1\n?###??#??#?????#??# 6,10\n???.#???????? 2,8\n????????#???#????. 1,1,3,2,2\n.?????..??#?#?. 1,1,5\n?.????#???.? 1,1,5,1\n##??#???.#?. 3,3,1\n????.???.?????#?##? 2,1,1,1,4\n?#?##.????...?? 5,1,1,2\n#?.?.??.#????#??#??? 1,1,10,1\n????????##??????#?? 4,6,4\n?????#??.#.. 1,4,1\n?????#??#?.. 3,4\n??#?????????#??# 1,11\n?????.??#??.????? 1,4,3\n?.?#.?????###?#.??. 1,2,1,6,1\n.???.???#??.???##?# 2,4,5\n?.???#.???#?###??# 1,1,1,1,5,1\n??#.#?????????? 1,1,2,5,1\n.??.????##????.??? 2,2,7,1\n??..??#???????.??..? 1,7,1,1\n???.?.???..? 1,1,3,1\n????..??.?#???.??. 2,1,1,2,1,1\n?###???#???????## 4,2,3,2\n.?##??.#??? 5,1\n?#??##?#?#??#?#???. 9,4\n.##?#?.##?????. 4,2,1\n??#???????? 3,3\n??#??#???#?..??#? 5,3,1,1\n.??#??#?????.?.#??? 10,1,1\n??#???.???? 5,1\n#????#???.?? 4,3,1\n.?##?????#? 6,2\n.##?#?##???????. 7,5\n?#??.??#????#??#??? 1,5,2,4\n???#???.#??#..?#??? 7,2,1,4\n?????.???.?.??.??. 1,2,1\n???.#.?.????? 1,1\n????????#?#?# 2,2,1,3\n?#???????#.???## 1,4,1,3\n?.????.????????? 1,1,1,5,2\n???.?????#. 3,1\n???.?#????.?# 1,2,1,1\n??#?.#??.? 1,3\n.?.??????#.????? 1,4,1,1,2\n#????.#?#???? 1,2,6\n..#?##??#??.#??#? 1,6,2,1\n.???????#?#???##??# 12,3,1\n.??#?.??#???????.# 1,1,1,1,3,1\n?..?????##??.?#????? 8,5\n.#?..?.??. 1,1\n...#??#?.? 1,1,1\n???#..?.????.#?## 1,1,1,2,4\n#?.???#??#???.#?#??? 2,2,1,2,2,4\n.##?#.??.??????? 4,1,1,1,1\n.?#?#????? 1,1,2\n???#???.??#.??? 4,3,2\n?#..#???###?#?#?#? 1,13\n#??#??#??????#???? 1,7,1,1,1,1\n#?.#??#????.??.?###? 1,2,2,1,1,4\n?#?#?.??????.????. 3,4,1\n.???.#?.??#.?.???# 2,1,1,1,1,3\n.????.?????#?#?. 2,8\n?#????###??? 1,4\n??#?##?????????.? 9,2,1,1\n???#??????????#.? 6,1,1,1\n.??#???#????##??#? 5,6\n??##???.??.#? 2,1\n?#?#?##???????????#? 10,1,5\n?.#?????.?.#????#?? 1,2,7\n?##?.???????? 2,3,1\n???.###????.#? 2,4,2\n??????.??? 1,1,2\n#???.????????.#? 1,1,2,2,1\n#.???????#? 1,3\n.?.##??.?#?.. 3,2\n#.?#.????##?#????.# 1,1,3,5,1\n?#?????#?#????? 5,1,1,1,2\n??.#??.?.???.?.#.??# 1,3,2,1,1,3\n.?.?#???#?? 1,4\n??.#??#?.?#???? 1,4,1,1\n?.?#????.?.#?# 2,2,3\n?##?.??#?#?.?#. 3,1,2,1\n?.??.???.???#???.? 1,2,3,3,1\n??##?#???####?#??? 4,1,5,1,2\n#.#??????????????#?? 1,1,3,1,1,6\n#?.?.?.#.#?.?????? 1,1,1,1,1,4\n???#?#.??? 1,3,2\n#?#??#??.##? 1,2,1,3\n??#??#????? 6,1\n???.?#???.? 1,1,2\n?.#..???#??##??? 1,4,4\n?..#??.#?... 1,1\n??...????#????.? 1,3,1,3\n???????#?#??????# 1,1,2,5,1\n?#???????##?.??? 3,6,2\n?#????#???? 2,2,1\n??????#???# 1,5\n?.????#??.?.??.. 6,1\n.??.??#????#? 1,1,1,5\n?##.???.?.?# 2,1,2\n????#??????? 1,2,1,2\n.#.???#????? 1,7\n???????#?#.? 2,2,3,1\n?.???#????????#? 1,3,4\n????????..? 3,2,1\n?.????#?.????????? 1,1,3,6,1\n??.#.?#????. 1,1,3,1\n.??#???????#?..? 5,1\n#?.??##?.????# 1,5,1\n???.?????#??. 3,6\n?.????..???????##? 2,9\n.?##..??????? 2,1,4\n?#?????????????#.? 6,4,1,1\n??#?##?#?? 5,1,1\n??#????#??????#?? 3,3,1,3\n????.?#..?#????? 1,1,3,2\n??#???...#?.?.??. 6,1,1,1\n?.????#?.#?. 1,1,2,1\n???#?#?????#?????.?? 6,1,1,1,1,1\n?????#?#???#??#?#?.. 7,8\n#..#.??.#??#?##??.. 1,1,1,1,6\n????.?#?#?? 3,6\n?#.?.#?????? 2,1,2,1\n??#?#??????????# 11,1\n?.#??####?????????#? 1,1,4,2,1,2\n?.?.?#?.??#?? 1,2,3\n????#???#????#?.???? 1,3,1,5,2\n???#?.???? 3,3\n?##??##.???.#?.##. 3,2,1,2,2\n?###??#?.?#.#??? 4,3,1,2,1\n.?????????##????? 2,8,2\n?.?#?..??#?????? 3,5,1\n#.??#???#????#.??? 1,12,1\n..?#????##? 2,2\n???????#???##???. 2,5,5\n???#??#??.#???.#.# 3,3,2,1,1,1\n.???#.#?????#??.?## 1,1,1,1,3,2\n#????????#. 3,1,1\n???#.#??#? 2,4\n????.##???#???.??? 1,1,9,1,1\n?.???#?#?.?#???? 6,4\n????????#?...#? 2,1\n????#????##???? 1,8,1\n?.???????#.. 2,4\n?..?#??#?##? 1,7\n?#???.#??.???##?? 2,2,4\n?##.????##??? 2,5\n??.?#..?.#?#??? 1,2,1,6\n???#??.?#??????# 4,9\n.?????.????### 5,6\n.##..#??#????... 2,8\n??#??.?????#?#? 1,1,1,3,4\n##??#.??#?? 2,1,2\n??##?###.##?#? 1,6,4\n.???????#?# 2,1,3\n??.???#?#.??##? 1,2,1,1,5\n?#???#?#.?#?#??#.? 2,4,2,4\n??????.??? 1,1\n??????????? 1,1,4\n???#?#?????##?? 7,4\n?##??????. 3,1,2\n?.#?.???.?.###?? 1,2,3\n???..??..#.##??. 3,2,1,2\n?.??.?????#?????# 1,1,1,7\n??.#.#..#?#? 1,1,1,4\n##?##???.?????##??.? 2,2,1,8,1\n.?.???.??.?????.?.?? 2,4\n??.???????.. 1,2\n?????#????????.#.??? 1,4,3,1,3\n?????.??#????. 1,2,6\n?##???##.??.? 8,1,1\n.##??????? 3,1\n?#?#??????????#?##?. 3,7,1,2\n#????#??.###?##.?? 1,4,1,6,1\n??#.??#??.? 1,5\n.?#?#???#???## 1,2,7\n??????#?###??.? 2,9,1\n???.??##?##.?? 1,4,2\n?????..????? 1,1,1,1\n??.?.????#??#?.? 1,1,6,1,1\n...?.#??#?#?#?? 2,5\n.????#???????.#. 6,1,3,1\n?.???#????. 1,7\n.?#???#????#?##?? 5,7\n????..?#??#??#???.? 1,9\n???##?#.???.?.? 6,1\n#??#??.??##?#???? 1,2,9\n?.????#??????? 2,9\n???????.?#. 1,2,1\n#?..??#???.??#?# 2,3,5\n????..??.??.? 1,1\n??????##.???? 3,2,1\n???.?????#?.##? 2,4,3\n#.??#???#.?#?????#?? 1,4,1,1,1,2\n??.?#????.??#? 2,6,1,1\n#?#.?????.??####??? 1,1,1,2,6,2\n??.???##?#???## 7,3\n.???.??#?? 1,3\n.??##.?????? 3,1\n##????#???#?#??#?? 13,2\n.??#??#?..# 7,1\n.?????#?.?#????#?? 7,1,3\n??#??.??????# 4,3,2\n??#?#...??###..??.?. 3,3,1,1\n?#.??#??.?#?..?? 2,3,2,1\n.??#?#?#?## 1,5,2\n?.#???.??#???#??#? 4,4,5\n?.??#??.#?.?#??#?. 1,2,1,2,1,3\n??#??.???????#?#?.?? 3,7\n?.??#?#?.????# 5,1,1\n??#?..?##.#?? 1,2,3,3\n.???.#???? 3,1,2\n???#?.???????? 2,6\n?.??###???.#.????. 5,1,1,4\n.??#??.?????? 4,2,1,1\n??.????#.?. 1,2\n#???.?.????????# 1,2,1,2,1\n???#???????#??#?.?? 2,2,4,1,1\n#??#???#?#??#.???. 5,1,4,2\n?##??????# 7,1\n?#?????.?.. 6,1\n????.?#.???###??. 1,1,7\n????#.#??. 2,1,3\n??.#????.??. 1,4,2\n.????#??.???#?.. 6,4\n?.????#??#?##?.?..?? 11,1\n?????#.?.????????.# 1,2,2,4,1\n?????###?#????? 1,1,3,1,1\n?#??##?#??##. 2,8\n??..?????#??##. 1,1,1,2,3\n.????#.???#??### 1,1,1,1,3\n??..##?????##.??.? 1,5,3,1,1\n??#?#?????# 6,1\n?????#??????????? 8,4\n?.???????# 4,1\n??????.???? 5,1\n????????#?.??????. 6,3\n.???#???.???# 5,2\n.??????..????#??## 2,9\n#???#???.?? 5,1\n???????#..??##?? 1,2,6\n???#????##???????? 2,9\n?#?.????#??#???#??. 2,1,11\n#??????#???####??.? 8,6\n????#?#???? 3,3\n??###.?.?????? 5,1,1\n????#???#?#?#?##?.. 1,2,9\n?####?.?.# 5,1,1\n??##?#??#? 2,1,2\n?.??##?.?.?##?##??? 5,3,3\n#??#.##?####?#??? 4,9\n?#??.#????#.?.?? 3,2,3,1,1\n?????##????#?#??##?# 9,4,2,1\n.????#??????? 3,2,3\n???????#?#??##?#? 2,1,7,1\n????????#?#???? 2,1,4\n.?#.#?##??##. 2,5,2\n??#?#?????#.?#?.?# 9,3,1\n??.?#???##?????.?? 11,1\n?.#??????##???#?? 1,1,1,3,3\n?#???.??????????#?. 3,1,3,1,4\n?#.?????.#?. 2,1,1\n????.????? 3,1,2\n#?.#?????#???? 2,7,1\n??#.?#?#?##??.#?.? 1,1,2,5,1\n??????#????.. 2,3\n.??#??.?.?..??.? 3,1\n?#?#.#?.???? 2,1,1,3\n#.?..????#????? 1,1,1,4,1\n??#???????? 4,4\n??????.????????#?? 4,1,1,3\n?#?....????. 2,2\n??#??#...??# 4,2\n??????.?????#? 4,1,1,3\n.##?#???#?????.#? 2,7,1,2\n??#?????#.??#? 4,3,3\n???#???????? 9,1\n?.?.#????#??#??.??## 1,10,3\n.?###?#..#.?. 6,1,1\n?#??..????#?#? 1,1,6\n..#.?????##?#? 1,1,6\n???.?.#????##?#?. 1,1,1,1,4\n?????????.?#??? 1,1,2\n????#??#??##? 1,2,1,2\n??#??.?###??????.? 3,8\n?#????????. 3,1,1\n???#?#???#??.?#.. 4,4,1\n?.#??.????#???????? 1,1,7,1,1,1\n???.??#?##????#? 1,8,1\n???.?.???????#????? 1,1,1,1,6,1\n..??#?.???#??? 4,4,1\n????????#?.???.???? 1,2,3,3,4\n?????????#??##???. 3,9\n#????..???????.???. 5,4,1,1\n??#?##???????. 6,5\n????.?#?.??...#??? 1,1,3,1,1,2\n?.??.##??.#?????.? 1,2,4,1,2,1\n?#?????????#???.???? 2,1,9,1,1\n??.?.?????.?# 1,1,4,1\n.??##?.#?? 4,3\n.??#??##.#???????? 1,1,3,4,3\n#???????#?#?.??.?? 1,3,1,1,1,1\n????##?#???????????# 1,9,3,1\n??#??..????????#?.?? 2,9,1\n??##?#??#.??.#? 5,2,2,1\n?###?????????.??.??? 4,4,1,1,1\n????.????????? 2,2\n????????##?..?. 2,1,3,1\n?.?.#?#???#??..????? 1,9,3\n??????#??.?#?#?.?? 1,1,4,1,1,1\n..????#?????????#?? 1,5,1,7\n?????????#?#??#..??? 4,8,1\n#??#???#.???.?..? 8,1\n?#??#?????.#??? 1,6,1\n???##??#???##???#.. 9,2,2\n?#????#..#??????#.. 1,4,2,4\n?????#.?.#?#? 3,3\n????.#.????.?? 3,1,1,1\n???#?..#????#??# 2,9\n???.###????#???????? 4,1,3\n??.??.?##?#?#???? 2,2,2,6\n???.???#?#???#??#?? 1,1,1,2,5,3\n.????##?##?##???#?? 1,13\n??????#????#.#?#? 9,1,4\n?????#??.#.??????#?? 7,1,8\n??#??????.??. 1,5,1\n??##?##????#??. 1,2,5,1,1\n??###??????.? 4,2,1\n#??????????..??#?.? 11,4\n??.??#?.???#?##?? 1,1,1,4\n.???.?#??????? 1,3,2\n.#?#??#.????### 6,2,3\n..??#???##.??#? 1,2,3,3\n??#?#?.#?#.?..?### 6,1,1,1,3\n??#????#??????.#. 1,1,4,2,1\n?????.??##?#??#?##?? 2,1,12\n??.?.?#???? 1,4\n??#???#?.???? 2,3,1,1\n.??.#.???..?????#??? 1,1,3,1,6\n???.?##?#? 2,3,1\n???????#????? 1,3,1\n??.????#.#. 1,5,1\n??..??#??? 1,3,1\n.#??##????#???#?.? 1,12\n#.#?#?????#??##??? 1,4,1,8\n??????#?#....? 8,1\n?.?.#????#?????? 1,3,3,1,1\n????#???.##?#.??.## 7,4,1,2\n#.?.???#?.?# 1,1,1,2\n?.#???#?#????#??? 3,1,8\n.????.##???.#???? 1,2,4,2,1\n.#??#..???#. 2,1,2\n???...???#?#????. 2,6\n??##?.??#.??? 1,3,2,1\n?#?##????????#?.? 7,4\n????#.??????. 4,3,1\n?#??????#. 5,1\n???.???#??#? 1,7\n?#????..?#??#? 5,4\n#????????????.?? 1,1,7,2\n?????#.???#? 1,3,1,1\n.???????????#??? 3,1,1,6\n??#????#????? 2,2,2\n.#???#??#??????? 2,7,4\n??????????##???.???? 1,1,9,3\n????..??.?#? 1,1,2,2\n#?????#?#??#???????? 3,14\n??#???.?#.? 1,1,2\n?????????????#?# 2,1,3,3\n???#.?????##????. 2,6,1,1\n?????.##???.? 3,4\n?.#????#?????. 2,7\n.###?????.. 3,2\n.??#??????.#?#. 4,1,1,1,1\n.###?#?##?##????. 11,2\n??????.??????##????? 1,1,1,9,1\n???#?.?.?.?? 4,1,1,1\n??#?##?.??#?????.#? 7,2,3,2\n???.###??.#??#? 1,1,5,1,2\n?.?#.?#?.?#????? 1,2,1,2,1\n#??????.##????? 6,3,1\n?#?#.????. 4,2\n?.????..?# 2,1\n?.?.?.##??#????##??? 1,1,14\n????#?.#???##?#????? 3,1,9,1,1\n??##????.#?#.#???? 1,5,1,1,5\n??#??????..?? 3,1,2,1\n#?.??#?###??#.?. 2,2,4,1,1\n?.#.??#?????? 1,3,1\n??.???##???.#??? 1,5,1,2,1\n#??##?#?#?.????? 5,1,1,1,1\n???.???###?? 2,6\n?#????#?.?#???#???? 2,3,1,5\n??#?####?????##???. 6,4\n##.??#???.??????? 2,3,1,4\n??????.#????#? 1,3,2,4\n#?.?????.???????#?# 2,1,1,10\n.??.?????#???.? 7,1\n?###.?#.?.?# 3,1,1,1\n#????????.??#????#?# 1,5,2,1,1,1\n??##?#?#??#?#???# 8,7\n???.?.???????#.??#? 2,1,1,6,1,2\n??.?????.?#?? 1,1,1,4\n.????#????##?##??. 3,8\n?.?????????? 2,4\n?????????#?#? 4,2,3\n#..??#????#??#.? 1,1,2,2,1\n?#.???????.??.? 1,1,5,2,1\n??#?.???????#.??##?? 2,1,2,2,3,1\n???.???.#??.??? 1,1,1,3,3\n#?#.???#..??? 3,1,1,2\n.#?##.?????#???.? 4,1,3,1\n#?.???????????##?? 1,1,2,8\n?#??.????? 2,2,1\n?#?##???#?##??..#? 1,2,1,2,1,1\n.????????#?. 2,4\n.#?.?##???????.?? 1,6,2\n#.??..##???#???.? 1,1,6,1,1\n?????.###?.??##??#? 1,1,4,1,3,2\n.???#?.??????.?#? 4,6,2\n????#?#????? 7,3\n???...#??. 3,3\n.#.?#??????#????#??# 1,7,1,5,1\n.???#???.?? 2,2\n.????.?#.?#??? 3,1,4\n??.#???#???????. 1,1,7\n??#?..??????# 2,1,1,1\n??##????..???.?# 7,3,2\n?#????#???#??..?##? 1,3,2,3\n?#.#??????##??###??? 2,4,1,9\n.??#.??###?? 1,1,7\n??????????? 1,3\n.?????#???. 1,4\n??????.??#?#???#?? 1,1,9,1\n#?.##?#.???#??? 1,4,1,2,1\n?###??##????##???? 7,8\n#???..?????.?. 1,1,3,1\n#??????#.?#? 1,2,1,2\n?.?#??#????.??? 1,4,2\n#.#????##.###?? 1,1,2,3\n?.?..????.#?..? 1,1,1,2,1\n?????.#???#???? 3,8\n??##?##?????#??#.? 4,2,4,2\n?????????# 1,1,5\n??.??#???#?????. 1,5,3,1\n?.#??.#?#????#??? 2,5,3\n.????.?..# 2,1,1\n?.?.??????#?#? 1,1,7\n?##????##????###??.? 16,1\n.??????#???#..?..??. 10,1,1\n?.#?#??.#???? 5,5\n?????.??#??#??????? 1,1,1,4,1,1\n???????.?..???..?? 5,1\n??????##????????? 2,8,1,1\n??????##???.????# 2,8,2,1\n##.?#?.#?? 2,2,1\n#?.?#.???????#??? 2,1,7\n?.????..??#???????? 4,6,1,1\n???#?##???? 2,6\n???????....#??#???. 4,4\n.?????.??? 5,2\n?.##??????? 2,4\n?##??##?????#????? 8,3,1,1\n.?.#??#?.? 1,3\n?#?????##?.?#??????? 3,3,1,1,3\n??.???##?????? 1,11\n???????#?.?#???? 9,2,1\n??.?#????#?#????? 1,7,1,1,1\n?.?????????#??#?#?? 1,1,11,1\n??.?##????? 1,3,1\n?#?#?????.##??###?? 2,2,2,8\n????#???#???#??. 2,11\n?.????#????## 5,3\n????#??#?#??.????? 1,1,6,1,1,1\n.??#?#??.???.? 5,2\n#??#?.?#?? 2,1,4\n?.??#???#.?? 1,5,1\n??##???#?.???##???? 7,6\n#?.?????###??? 2,1,8\n??#?#?#???.#??? 1,7,2\n#.?#??#.?? 1,4\n????????#????.#? 1,5,1,1\n?#?.???.??? 3,2\n?????#?.??#?##..#?. 2,1,1,6,1\n??#?..###???# 2,3,3\n?.?#.?.?#????# 1,2,7\n?.##?##??#??.#????## 6,3,1,4\n.#??###??????#. 8,3\n????#??#..? 4,2\n.???.????.???#?? 3,1,5\n.?#????#?#?#?#????# 1,13\n?.?#.#..?.???#??# 1,1,1,7\n???..?#??.??##? 1,2,1,5\n?.?#?#?#.###??? 1,1,1,1,6\n???.???#???#?.#?.?. 1,6,2,1,1\n.?.?##..???????? 1,2,6\n.#.?#???#?.?????? 1,3,1,2,2\n#?????#???##??# 3,7,2\n#.?#??#??.??.?? 1,1,4,1,1\n??#??#???##.??##? 4,2,3\n.?#?.#??#??.???? 1,6,2\n##.???.???##?? 2,1,5\n.?.#???##?#??? 1,9,1\n????#?##.????# 4,2,1,2\n???????##?#?????.? 4,8,1,1\n????##?#?#??. 1,8`;

function inputToSprings(input) {
  const lines = input.split('\n');
  const springs = [];
  for (const line of lines) {
    const [springStr, dmg] = line.split(' ');
    const damaged = dmg.split(',').map(Number);
    springs.push({springStr, damaged});
  }
  return springs;
}

function getNbArrangements(springStr, damaged) {
  if (springStr.length == 0) return damaged.length == 0 ? 1 : 0;
  if (damaged.length == 0) return springStr.includes('#') ? 0 : 1;

  if (springStr[0] == '.') {
    return getNbArrangements(springStr.slice(1), damaged);
  }
  if (springStr[0] == '#') {
    const [dmg, ...restDamaged] = damaged;
    if (springStr.slice(0, dmg).includes('.')) return 0;
    if (springStr[dmg] == '#') return 0;
    if (springStr.length < dmg) return 0;
    return getNbArrangements(springStr.slice(dmg + 1), restDamaged);
  }
  return getNbArrangements('#' + springStr.slice(1), damaged)
       + getNbArrangements('.' + springStr.slice(1), damaged);
}

// part 1
const springs = inputToSprings(input);
let sum = 0;
for (const spring of springs) {
  sum += getNbArrangements(spring.springStr, spring.damaged);
}
console.log(sum);

// part 2
function memoize(fn, cache = new Map()) {
  return (...args) => {
    const key = JSON.stringify(args);
    if (cache.has(key)) return cache.get(key);
    const result = fn(...args);
    cache.set(key, result);
    return result;
  }
}

getNbArrangements = memoize(getNbArrangements);

let sumP2 = 0;
for (const spring of springs) {
  const springStr = Array(5).fill(spring.springStr).join('?');
  const damaged = Array(5).fill(spring.damaged).flat();
  sumP2 += getNbArrangements(springStr, damaged);
}
console.log(sumP2);