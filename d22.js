const input = `0,2,136~0,4,136\n6,1,163~6,3,163\n0,4,134~0,7,134\n4,9,287~6,9,287\n5,0,105~5,2,105\n1,7,19~3,7,19\n5,2,213~7,2,213\n0,8,139~1,8,139\n9,7,50~9,7,50\n9,1,138~9,3,138\n8,1,56~8,3,56\n8,2,177~8,4,177\n7,7,112~8,7,112\n3,4,39~3,4,41\n1,3,26~3,3,26\n5,5,147~5,7,147\n7,5,107~7,7,107\n7,6,253~7,6,255\n6,0,134~8,0,134\n1,1,167~3,1,167\n5,7,34~5,9,34\n5,1,178~5,3,178\n5,4,35~5,6,35\n7,5,122~9,5,122\n6,2,56~6,5,56\n3,5,185~3,5,187\n7,3,111~9,3,111\n3,6,207~3,7,207\n4,9,170~5,9,170\n6,4,12~9,4,12\n0,2,46~2,2,46\n0,4,265~0,6,265\n3,7,3~6,7,3\n3,7,8~3,9,8\n6,4,173~7,4,173\n3,7,223~3,9,223\n7,5,165~7,7,165\n1,6,22~1,8,22\n2,5,130~4,5,130\n8,4,134~8,7,134\n9,5,48~9,8,48\n8,7,159~9,7,159\n8,0,59~8,2,59\n9,7,115~9,8,115\n3,1,98~3,3,98\n7,1,75~8,1,75\n4,3,42~6,3,42\n5,2,227~7,2,227\n0,8,65~3,8,65\n2,6,95~5,6,95\n2,6,55~2,8,55\n4,7,229~4,8,229\n4,0,28~4,2,28\n7,4,254~8,4,254\n1,0,106~1,3,106\n2,0,116~2,3,116\n2,6,107~2,8,107\n0,0,99~1,0,99\n3,5,122~3,8,122\n3,1,209~4,1,209\n2,2,124~2,4,124\n1,5,35~1,7,35\n7,7,170~7,9,170\n6,8,104~8,8,104\n0,1,52~0,3,52\n5,5,142~8,5,142\n6,7,160~6,8,160\n7,1,115~7,2,115\n5,0,95~5,2,95\n6,7,150~7,7,150\n4,2,45~4,4,45\n6,4,295~9,4,295\n9,3,43~9,6,43\n9,0,100~9,2,100\n4,2,36~5,2,36\n1,5,251~1,7,251\n6,4,264~6,7,264\n1,6,104~2,6,104\n5,4,11~5,7,11\n4,3,92~4,3,94\n6,3,87~9,3,87\n9,0,2~9,1,2\n5,3,231~5,3,233\n7,3,84~7,7,84\n1,4,29~4,4,29\n2,7,44~2,7,46\n8,5,262~9,5,262\n4,7,134~5,7,134\n3,6,85~5,6,85\n1,8,46~3,8,46\n0,2,3~0,2,5\n0,7,111~2,7,111\n8,6,220~8,8,220\n5,0,194~6,0,194\n5,4,206~5,7,206\n1,1,274~1,4,274\n3,5,72~3,6,72\n6,2,192~6,4,192\n0,2,273~0,5,273\n0,7,109~0,7,109\n0,7,139~3,7,139\n4,5,300~5,5,300\n3,6,241~6,6,241\n9,4,174~9,6,174\n6,2,245~6,5,245\n3,4,120~5,4,120\n4,2,175~7,2,175\n0,0,94~2,0,94\n8,6,28~9,6,28\n0,1,111~2,1,111\n1,6,89~4,6,89\n2,5,34~2,5,35\n9,0,201~9,2,201\n8,7,7~8,7,9\n2,7,99~2,9,99\n1,7,232~3,7,232\n9,4,217~9,7,217\n6,4,116~9,4,116\n3,9,103~4,9,103\n3,5,78~3,5,80\n4,0,225~4,0,228\n4,4,14~4,7,14\n2,4,280~2,6,280\n8,2,119~8,5,119\n6,5,290~7,5,290\n1,0,290~1,3,290\n3,0,280~3,3,280\n6,3,204~6,4,204\n3,8,182~3,8,185\n4,1,268~4,3,268\n7,5,124~7,6,124\n0,6,139~0,6,139\n3,5,66~3,5,68\n3,7,225~3,7,226\n1,9,13~2,9,13\n4,0,45~4,1,45\n3,8,32~5,8,32\n0,6,279~4,6,279\n3,2,270~6,2,270\n6,8,44~8,8,44\n9,5,177~9,7,177\n5,4,78~5,7,78\n2,7,143~4,7,143\n3,8,61~5,8,61\n0,5,263~0,6,263\n2,6,223~2,6,223\n5,7,118~5,9,118\n1,1,55~2,1,55\n5,5,283~8,5,283\n4,5,12~4,7,12\n0,0,140~0,2,140\n9,7,9~9,8,9\n0,1,154~0,2,154\n0,4,193~0,5,193\n4,3,24~7,3,24\n3,1,189~4,1,189\n7,9,112~8,9,112\n6,3,5~6,7,5\n4,7,86~4,8,86\n2,5,126~2,5,129\n3,2,111~5,2,111\n1,5,224~2,5,224\n8,0,132~8,1,132\n0,4,58~0,7,58\n0,7,259~0,9,259\n0,7,97~2,7,97\n7,0,289~7,2,289\n4,8,157~7,8,157\n5,0,136~7,0,136\n5,3,110~6,3,110\n6,5,85~8,5,85\n7,6,167~8,6,167\n8,2,152~8,2,156\n3,1,79~5,1,79\n5,8,278~5,8,281\n5,5,172~7,5,172\n6,4,176~6,4,178\n2,4,165~2,8,165\n7,0,180~7,2,180\n9,3,56~9,4,56\n2,8,179~4,8,179\n4,0,274~4,2,274\n3,4,243~6,4,243\n1,0,97~1,2,97\n4,8,134~6,8,134\n6,9,173~8,9,173\n3,9,100~5,9,100\n3,1,4~3,3,4\n7,4,247~7,6,247\n7,1,95~9,1,95\n7,0,21~7,1,21\n3,9,12~3,9,13\n1,8,256~1,8,258\n5,2,45~5,4,45\n7,3,158~7,4,158\n2,1,7~5,1,7\n4,4,307~7,4,307\n8,3,256~8,5,256\n4,6,16~6,6,16\n5,5,141~6,5,141\n5,9,271~7,9,271\n6,4,166~8,4,166\n5,1,215~7,1,215\n3,1,172~6,1,172\n2,6,113~5,6,113\n8,0,38~8,1,38\n1,2,36~1,4,36\n6,2,170~8,2,170\n1,8,249~2,8,249\n7,6,67~9,6,67\n6,4,301~6,5,301\n4,5,237~5,5,237\n2,8,167~2,9,167\n7,1,79~8,1,79\n9,4,36~9,5,36\n8,7,12~8,7,12\n0,2,267~2,2,267\n5,3,161~9,3,161\n0,6,166~2,6,166\n2,5,290~2,8,290\n8,5,155~8,7,155\n3,1,25~3,4,25\n8,4,89~8,6,89\n2,1,143~2,3,143\n9,2,90~9,4,90\n0,1,139~0,3,139\n6,5,152~6,7,152\n9,7,225~9,9,225\n1,5,95~3,5,95\n1,2,148~2,2,148\n6,2,10~6,2,13\n6,5,151~8,5,151\n9,0,164~9,1,164\n9,2,287~9,2,289\n3,4,201~3,4,204\n4,4,149~4,6,149\n1,4,59~4,4,59\n9,1,28~9,3,28\n4,9,63~6,9,63\n6,4,246~6,7,246\n4,6,101~5,6,101\n1,5,83~3,5,83\n2,0,10~2,0,12\n0,9,178~2,9,178\n4,8,42~4,8,44\n2,7,64~4,7,64\n5,5,59~5,6,59\n7,0,94~9,0,94\n6,6,46~8,6,46\n7,6,127~7,8,127\n8,4,50~8,4,51\n2,3,55~6,3,55\n8,5,92~8,6,92\n9,6,247~9,8,247\n9,2,140~9,2,142\n9,7,36~9,9,36\n4,9,35~7,9,35\n9,1,229~9,2,229\n5,0,278~5,1,278\n4,5,156~4,6,156\n0,4,9~1,4,9\n0,7,117~0,9,117\n5,5,297~5,7,297\n2,2,220~2,3,220\n7,0,227~7,1,227\n1,1,180~1,3,180\n9,2,137~9,3,137\n8,1,171~8,1,172\n5,7,117~5,9,117\n4,9,255~4,9,258\n6,5,145~6,7,145\n2,8,257~3,8,257\n5,8,274~6,8,274\n4,9,96~6,9,96\n6,4,47~9,4,47\n5,7,209~8,7,209\n9,6,114~9,8,114\n0,1,55~0,4,55\n4,3,109~4,4,109\n5,6,36~5,6,38\n2,0,270~2,2,270\n9,6,37~9,8,37\n0,1,243~3,1,243\n4,5,16~7,5,16\n7,1,15~7,4,15\n2,3,90~4,3,90\n7,0,224~9,0,224\n3,1,273~3,3,273\n4,1,130~7,1,130\n4,6,59~4,8,59\n6,4,288~6,7,288\n0,6,33~2,6,33\n6,8,277~7,8,277\n3,7,283~3,8,283\n1,3,48~1,4,48\n3,6,49~3,8,49\n5,4,137~8,4,137\n7,7,98~7,9,98\n4,3,1~4,6,1\n0,8,67~1,8,67\n3,8,247~5,8,247\n0,6,102~0,8,102\n4,0,5~7,0,5\n1,1,183~1,2,183\n3,4,149~3,6,149\n1,1,113~1,1,116\n9,6,31~9,8,31\n5,3,130~7,3,130\n1,6,115~1,8,115\n5,8,4~6,8,4\n0,9,242~3,9,242\n1,2,58~1,4,58\n7,5,101~7,8,101\n2,1,291~2,3,291\n9,4,78~9,6,78\n0,4,191~0,6,191\n6,6,62~6,6,65\n7,4,174~7,4,176\n5,0,191~7,0,191\n0,3,296~0,3,298\n5,6,302~5,7,302\n3,7,159~3,9,159\n7,4,259~7,5,259\n4,0,85~4,2,85\n6,0,286~7,0,286\n4,2,276~4,2,276\n2,6,31~5,6,31\n1,1,101~3,1,101\n6,0,210~6,0,213\n6,1,60~6,4,60\n2,0,98~2,2,98\n3,2,101~3,3,101\n1,9,11~3,9,11\n5,2,237~5,3,237\n7,5,152~7,8,152\n9,8,50~9,9,50\n5,6,88~5,8,88\n9,6,181~9,8,181\n4,1,129~6,1,129\n6,0,109~7,0,109\n3,0,139~5,0,139\n2,3,277~2,6,277\n3,3,265~5,3,265\n4,3,35~4,4,35\n2,3,273~2,6,273\n7,8,155~7,9,155\n2,2,70~2,3,70\n2,4,168~2,6,168\n7,2,92~7,5,92\n3,2,284~3,5,284\n2,0,236~2,3,236\n6,1,126~6,5,126\n8,4,132~8,7,132\n0,1,39~0,4,39\n5,2,27~5,2,30\n8,5,113~8,8,113\n4,4,28~4,6,28\n3,8,275~3,9,275\n4,5,17~7,5,17\n3,8,255~6,8,255\n0,7,256~2,7,256\n6,2,298~6,4,298\n4,7,296~6,7,296\n4,8,115~6,8,115\n0,6,99~0,8,99\n3,3,172~3,6,172\n9,0,24~9,3,24\n0,6,262~1,6,262\n1,3,7~1,3,9\n6,1,115~6,2,115\n7,6,264~7,8,264\n8,1,282~8,3,282\n1,0,167~1,0,167\n4,6,225~4,9,225\n4,8,239~4,9,239\n4,1,29~8,1,29\n4,6,115~5,6,115\n5,2,271~5,2,272\n5,4,286~8,4,286\n7,8,164~7,8,164\n8,4,78~8,5,78\n9,6,131~9,9,131\n2,7,145~4,7,145\n3,5,117~3,7,117\n7,5,103~7,7,103\n0,3,95~3,3,95\n2,6,215~5,6,215\n6,2,76~6,2,77\n3,1,188~6,1,188\n2,2,22~5,2,22\n1,2,7~2,2,7\n3,9,61~5,9,61\n6,1,76~6,1,78\n5,5,110~7,5,110\n5,5,33~5,5,34\n9,6,111~9,7,111\n3,4,245~5,4,245\n8,5,156~8,7,156\n4,3,272~5,3,272\n4,2,150~6,2,150\n5,2,72~5,3,72\n0,6,147~0,9,147\n0,0,157~0,2,157\n0,5,187~0,5,189\n1,1,53~1,4,53\n3,5,37~5,5,37\n0,8,97~1,8,97\n6,3,31~6,4,31\n6,2,59~6,3,59\n4,6,299~4,8,299\n6,1,61~6,3,61\n2,6,239~2,9,239\n5,8,238~8,8,238\n3,7,245~3,9,245\n4,3,7~4,6,7\n4,5,255~4,7,255\n2,6,231~3,6,231\n1,7,186~1,9,186\n2,7,83~5,7,83\n6,6,212~6,7,212\n1,1,12~1,3,12\n2,3,200~5,3,200\n7,4,130~9,4,130\n6,0,283~8,0,283\n5,6,209~8,6,209\n0,0,8~0,2,8\n2,1,160~2,4,160\n9,2,202~9,5,202\n4,2,82~4,5,82\n8,2,90~8,3,90\n1,6,248~1,9,248\n7,5,146~8,5,146\n9,5,167~9,7,167\n8,3,58~8,5,58\n1,9,187~2,9,187\n0,8,158~1,8,158\n2,4,199~4,4,199\n0,4,59~0,6,59\n5,5,87~8,5,87\n0,1,155~0,3,155\n1,3,3~1,3,5\n0,7,6~0,9,6\n8,3,2~9,3,2\n0,2,40~0,3,40\n3,0,190~5,0,190\n4,6,201~4,7,201\n2,0,239~2,0,239\n4,7,24~4,7,27\n5,1,210~5,4,210\n2,2,289~2,5,289\n4,6,253~4,7,253\n8,3,44~9,3,44\n0,4,194~0,5,194\n2,1,43~3,1,43\n6,2,19~8,2,19\n6,2,249~6,5,249\n2,9,126~5,9,126\n0,3,10~0,6,10\n8,3,219~8,5,219\n1,2,43~1,5,43\n3,3,62~3,5,62\n2,6,49~2,8,49\n7,3,222~8,3,222\n4,1,31~5,1,31\n7,3,170~7,6,170\n2,4,207~2,4,210\n9,2,40~9,2,42\n5,4,101~7,4,101\n5,5,252~7,5,252\n2,1,24~2,3,24\n6,6,173~9,6,173\n1,6,100~1,8,100\n1,2,224~3,2,224\n3,3,269~5,3,269\n6,0,36~8,0,36\n1,6,103~1,7,103\n3,7,89~3,9,89\n2,2,5~4,2,5\n1,7,180~1,9,180\n9,5,260~9,7,260\n5,9,169~7,9,169\n6,4,255~6,6,255\n3,6,141~3,7,141\n2,9,44~4,9,44\n5,8,257~7,8,257\n1,3,111~1,5,111\n1,4,103~4,4,103\n8,7,214~9,7,214\n9,6,263~9,9,263\n5,5,128~7,5,128\n8,4,46~9,4,46\n1,5,75~3,5,75\n9,1,43~9,2,43\n2,7,114~5,7,114\n2,0,242~2,1,242\n4,6,103~6,6,103\n3,5,107~6,5,107\n5,2,17~5,2,21\n0,0,158~1,0,158\n1,6,55~1,8,55\n9,4,292~9,5,292\n9,5,34~9,7,34\n7,3,249~7,5,249\n5,6,18~7,6,18\n4,3,198~4,6,198\n2,0,41~2,2,41\n2,8,113~3,8,113\n7,5,260~8,5,260\n0,2,152~2,2,152\n7,6,250~9,6,250\n6,4,147~6,5,147\n5,4,140~5,5,140\n5,1,108~5,3,108\n6,0,230~7,0,230\n2,1,279~4,1,279\n1,2,172~4,2,172\n8,5,253~8,6,253\n4,8,236~5,8,236\n7,5,90~8,5,90\n2,7,230~2,9,230\n2,1,121~2,1,125\n7,6,265~7,6,266\n8,1,139~9,1,139\n7,4,167~7,4,169\n0,2,73~3,2,73\n5,1,147~5,2,147\n4,5,241~4,5,244\n1,6,252~1,7,252\n2,1,164~3,1,164\n9,3,40~9,4,40\n5,5,81~7,5,81\n0,1,120~2,1,120\n1,5,169~1,6,169\n2,6,10~6,6,10\n3,0,97~6,0,97\n4,7,166~5,7,166\n2,9,133~4,9,133\n6,1,75~6,2,75\n8,2,93~9,2,93\n7,8,223~9,8,223\n1,9,170~3,9,170\n2,9,64~2,9,64\n5,3,15~5,3,17\n8,2,291~8,4,291\n2,9,62~3,9,62\n1,3,263~3,3,263\n0,9,148~0,9,148\n1,3,166~3,3,166\n8,2,128~8,6,128\n5,4,150~6,4,150\n4,3,3~5,3,3\n4,1,210~4,1,212\n4,2,292~4,4,292\n6,4,115~7,4,115\n4,0,230~5,0,230\n7,2,36~8,2,36\n5,7,139~5,7,139\n1,4,283~3,4,283\n9,3,134~9,6,134\n4,0,98~4,0,98\n2,5,252~2,7,252\n1,3,181~1,3,184\n7,5,36~8,5,36\n5,4,207~5,5,207\n1,6,94~1,8,94\n2,6,110~2,8,110\n1,5,32~4,5,32\n8,4,285~8,5,285\n8,7,165~8,9,165\n4,1,145~4,4,145\n2,7,17~4,7,17\n0,6,73~0,8,73\n0,5,137~0,8,137\n3,0,40~4,0,40\n5,2,148~5,2,149\n4,3,9~6,3,9\n8,1,32~8,3,32\n1,6,73~3,6,73\n3,7,22~5,7,22\n3,7,156~3,9,156\n5,9,137~7,9,137\n5,7,128~5,8,128\n3,4,175~3,6,175\n2,4,123~2,7,123\n3,0,43~3,0,46\n1,4,189~3,4,189\n2,0,222~4,0,222\n2,2,167~2,4,167\n6,7,274~7,7,274\n0,2,269~0,4,269\n4,6,257~4,7,257\n5,1,277~7,1,277\n8,8,13~8,8,13\n1,1,233~1,3,233\n0,9,1~0,9,4\n7,3,270~7,5,270\n4,0,141~4,0,142\n2,4,143~2,5,143\n8,5,24~8,7,24\n5,3,273~6,3,273\n6,2,114~8,2,114\n5,4,266~7,4,266\n3,0,120~3,3,120\n9,1,228~9,3,228\n4,7,301~7,7,301\n1,1,295~1,1,295\n5,2,212~5,3,212\n3,3,187~4,3,187\n5,1,126~5,3,126\n4,2,184~6,2,184\n1,8,252~3,8,252\n1,0,150~1,3,150\n2,2,8~2,5,8\n6,9,175~6,9,177\n8,1,117~8,3,117\n8,2,288~8,5,288\n0,7,288~0,9,288\n1,3,152~1,3,154\n7,0,203~9,0,203\n1,1,14~1,2,14\n7,0,279~7,2,279\n5,5,286~7,5,286\n1,0,47~4,0,47\n5,0,283~5,1,283\n4,1,74~7,1,74\n1,8,253~3,8,253\n3,0,193~3,2,193\n6,1,36~6,2,36\n5,4,269~5,7,269\n4,8,300~5,8,300\n5,2,234~8,2,234\n3,0,42~4,0,42\n7,1,297~7,2,297\n0,8,70~1,8,70\n4,1,276~7,1,276\n6,9,180~9,9,180\n6,3,147~8,3,147\n6,4,267~6,4,270\n2,4,102~2,7,102\n7,0,77~7,1,77\n1,5,135~1,6,135\n2,1,163~2,4,163\n3,9,173~4,9,173\n9,8,267~9,9,267\n0,6,131~2,6,131\n3,5,190~3,5,192\n0,9,15~3,9,15\n2,3,218~2,6,218\n8,2,27~9,2,27\n3,0,117~5,0,117\n7,0,212~7,2,212\n0,2,179~2,2,179\n3,2,184~3,5,184\n0,3,97~2,3,97\n4,4,88~4,6,88\n0,0,293~2,0,293\n3,2,176~5,2,176\n3,7,170~6,7,170\n2,6,53~2,8,53\n4,7,122~6,7,122\n9,8,249~9,8,252\n6,4,253~9,4,253\n2,2,186~2,3,186\n5,7,211~5,7,211\n6,0,222~8,0,222\n2,2,271~4,2,271\n3,3,143~3,5,143\n2,4,99~4,4,99\n7,1,228~7,1,228\n6,6,272~6,8,272\n8,1,168~9,1,168\n0,6,1~0,7,1\n8,2,129~8,2,131\n1,8,52~3,8,52\n0,8,114~0,8,115\n5,2,12~5,3,12\n0,8,188~1,8,188\n8,4,145~8,4,148\n1,3,55~1,5,55\n3,0,51~3,2,51\n6,8,3~9,8,3\n8,6,174~8,8,174\n6,9,216~7,9,216\n7,0,291~7,0,293\n3,5,133~3,7,133\n1,5,238~4,5,238\n9,4,162~9,7,162\n1,5,150~4,5,150\n7,9,167~9,9,167\n8,3,144~8,5,144\n1,9,10~3,9,10\n0,0,295~4,0,295\n6,1,198~6,3,198\n2,4,57~2,6,57\n9,2,180~9,5,180\n0,0,1~0,1,1\n1,8,131~4,8,131\n4,5,124~4,7,124\n1,6,246~4,6,246\n1,0,153~2,0,153\n5,1,78~5,3,78\n1,5,69~3,5,69\n3,8,92~3,9,92\n6,3,252~7,3,252\n8,6,299~8,7,299\n6,0,33~6,1,33\n3,0,245~3,1,245\n4,8,66~4,9,66\n8,2,174~8,4,174\n6,7,273~6,8,273\n4,3,193~4,3,195\n0,0,2~0,2,2\n6,5,64~9,5,64\n4,2,72~4,2,75\n5,6,232~5,8,232\n1,3,67~5,3,67\n7,1,290~8,1,290\n0,3,3~0,3,4\n3,1,20~4,1,20\n0,0,60~0,3,60\n9,7,52~9,7,54\n3,6,124~3,9,124\n3,0,187~3,2,187\n8,3,53~8,4,53\n6,7,63~8,7,63\n8,8,279~8,9,279\n2,2,290~5,2,290\n5,6,248~6,6,248\n3,6,222~3,8,222\n2,1,286~2,3,286\n2,0,117~2,2,117\n5,4,77~9,4,77\n2,3,52~4,3,52\n3,2,186~3,4,186\n3,0,37~3,1,37\n3,5,15~5,5,15\n6,0,122~6,0,124\n6,0,99~8,0,99\n4,1,235~5,1,235\n1,7,254~1,9,254\n9,4,251~9,6,251\n2,1,23~2,3,23\n4,6,290~6,6,290\n7,4,272~7,4,274\n9,6,269~9,8,269\n6,5,39~6,6,39\n7,9,52~9,9,52\n4,4,240~4,5,240\n7,6,106~8,6,106\n1,2,108~2,2,108\n8,1,287~8,3,287\n1,8,262~4,8,262\n8,3,170~8,4,170\n6,9,274~8,9,274\n0,4,67~0,5,67\n2,5,294~2,7,294\n9,3,296~9,4,296\n6,0,225~6,1,225\n1,8,284~1,9,284\n7,5,300~7,7,300\n1,0,31~1,3,31\n8,5,212~8,7,212\n7,5,256~7,7,256\n3,4,15~6,4,15\n4,4,259~4,5,259\n0,6,125~3,6,125\n1,9,134~2,9,134\n8,3,164~8,4,164\n6,1,62~6,3,62\n6,0,2~6,0,4\n2,9,226~4,9,226\n6,4,157~8,4,157\n4,3,214~6,3,214\n5,2,39~5,4,39\n9,3,289~9,4,289\n3,0,116~3,2,116\n5,7,136~5,9,136\n2,4,152~4,4,152\n5,5,61~5,7,61\n3,0,172~5,0,172\n7,5,61~7,7,61\n7,8,239~9,8,239\n6,5,62~7,5,62\n2,7,251~2,9,251\n5,6,21~8,6,21\n7,0,18~7,2,18\n0,7,261~0,9,261\n0,4,36~0,6,36\n2,6,128~2,8,128\n5,3,81~5,4,81\n0,2,100~0,5,100\n3,0,281~3,2,281\n8,6,38~9,6,38\n6,1,302~6,4,302\n5,4,289~5,4,291\n6,3,45~8,3,45\n2,8,134~3,8,134\n8,0,219~8,2,219\n5,9,128~8,9,128\n4,3,190~6,3,190\n4,3,293~4,5,293\n7,3,21~9,3,21\n1,7,2~2,7,2\n0,7,40~0,8,40\n9,2,139~9,4,139\n2,8,59~2,9,59\n5,5,62~5,6,62\n4,5,30~7,5,30\n5,7,23~8,7,23\n2,5,60~2,5,63\n2,4,221~3,4,221\n5,7,266~5,8,266\n8,6,137~8,8,137\n5,3,123~6,3,123\n1,3,108~1,5,108\n7,0,209~9,0,209\n9,2,259~9,3,259\n5,5,167~7,5,167\n5,9,163~8,9,163\n4,4,10~6,4,10\n9,1,283~9,4,283\n4,1,30~4,4,30\n5,2,144~5,4,144\n2,4,58~4,4,58\n1,6,254~1,6,257\n5,4,127~6,4,127\n4,4,202~6,4,202\n6,4,23~6,4,25\n7,2,224~7,4,224\n8,0,137~8,0,138\n6,4,214~6,7,214\n6,9,1~8,9,1\n0,1,290~0,1,290\n2,4,105~2,5,105\n0,1,228~3,1,228\n6,3,63~9,3,63\n6,5,108~6,6,108\n1,1,96~3,1,96\n4,7,41~4,9,41\n0,6,39~0,8,39\n5,5,265~7,5,265\n4,9,270~6,9,270\n5,6,132~5,6,134\n1,9,162~4,9,162\n1,6,295~3,6,295\n8,5,289~8,5,290\n3,6,152~3,8,152\n9,6,179~9,9,179\n3,3,110~4,3,110\n5,8,83~7,8,83\n5,6,91~8,6,91\n7,4,139~8,4,139\n0,1,288~3,1,288\n6,9,113~8,9,113\n9,4,220~9,7,220\n4,7,250~4,9,250\n1,5,65~3,5,65\n1,9,285~4,9,285\n0,7,149~1,7,149\n8,8,240~8,9,240\n1,0,8~4,0,8\n6,1,217~9,1,217\n4,7,163~6,7,163\n5,4,113~8,4,113\n3,0,171~3,2,171\n9,2,223~9,4,223\n6,3,119~6,4,119\n1,0,165~1,0,165\n9,5,125~9,5,128\n8,2,283~8,2,285\n0,7,66~3,7,66\n5,6,93~5,6,93\n0,3,50~2,3,50\n4,0,275~4,0,275\n8,3,299~9,3,299\n8,3,165~9,3,165\n1,6,282~1,9,282\n5,9,277~6,9,277\n6,5,31~8,5,31\n4,8,228~4,9,228\n5,1,102~5,4,102\n8,0,284~8,0,284\n6,5,268~7,5,268\n6,6,43~6,8,43\n1,4,17~4,4,17\n8,6,140~8,8,140\n3,5,91~4,5,91\n8,7,66~8,8,66\n4,9,64~6,9,64\n3,3,3~3,4,3\n7,2,35~7,4,35\n4,5,151~4,5,153\n6,4,59~6,6,59\n9,3,22~9,5,22\n5,2,13~5,4,13\n3,9,99~5,9,99\n1,3,269~1,5,269\n9,7,266~9,9,266\n1,4,45~1,6,45\n7,4,118~8,4,118\n1,3,222~1,6,222\n3,0,204~7,0,204\n9,4,24~9,4,26\n1,6,266~3,6,266\n5,5,125~5,7,125\n4,5,168~4,7,168\n9,4,49~9,4,51\n7,5,45~9,5,45\n7,3,26~7,4,26\n7,6,109~7,9,109\n1,3,63~3,3,63\n4,4,229~4,4,231\n7,6,163~9,6,163\n0,1,103~0,5,103\n2,2,74~3,2,74\n7,8,45~7,9,45\n0,9,227~2,9,227\n6,0,7~6,2,7\n3,6,80~5,6,80\n7,4,22~7,6,22\n1,0,275~1,0,278\n5,2,230~5,4,230\n0,1,185~0,2,185\n8,7,39~8,9,39\n5,7,119~5,9,119\n2,9,272~4,9,272\n1,6,144~3,6,144\n3,4,142~6,4,142\n5,4,117~6,4,117\n6,3,294~8,3,294\n2,9,254~4,9,254\n0,4,44~0,7,44\n4,6,25~6,6,25\n1,1,277~1,1,279\n1,3,42~3,3,42\n5,6,212~5,8,212\n3,1,206~5,1,206\n1,7,32~4,7,32\n3,0,287~3,2,287\n1,3,260~1,6,260\n0,3,141~2,3,141\n4,2,206~4,3,206\n3,2,158~3,4,158\n9,7,7~9,8,7\n1,8,9~1,9,9\n8,0,119~8,1,119\n5,3,207~6,3,207\n4,4,227~4,6,227\n2,6,182~2,8,182\n4,7,204~4,9,204\n4,3,275~4,4,275\n4,1,17~6,1,17\n5,3,73~8,3,73\n2,5,282~4,5,282\n6,7,213~6,9,213\n5,6,154~7,6,154\n3,1,93~5,1,93\n8,0,175~8,2,175\n6,1,127~6,3,127\n5,0,281~7,0,281\n6,4,30~7,4,30\n3,8,276~5,8,276\n7,4,119~7,7,119\n5,5,7~7,5,7\n3,4,101~3,6,101\n1,6,34~2,6,34\n3,2,279~5,2,279\n3,1,176~5,1,176\n7,4,172~8,4,172\n2,6,220~2,8,220\n2,6,35~3,6,35\n2,1,184~2,3,184\n1,4,2~1,6,2\n2,6,237~2,8,237\n1,4,223~1,6,223\n4,3,84~4,5,84\n0,6,62~3,6,62\n5,7,95~8,7,95\n5,6,295~5,7,295\n2,1,223~5,1,223\n3,6,244~5,6,244\n2,0,92~2,3,92\n8,8,69~8,8,71\n1,4,19~1,6,19\n6,5,106~9,5,106\n0,5,65~0,6,65\n1,1,293~1,3,293\n2,8,178~4,8,178\n9,4,53~9,6,53\n6,8,269~6,8,271\n1,6,275~2,6,275\n0,1,142~0,3,142\n6,4,22~6,6,22\n3,5,146~5,5,146\n5,7,100~7,7,100\n0,3,197~0,4,197\n0,3,29~2,3,29\n6,9,217~8,9,217\n6,7,260~6,9,260\n3,6,230~6,6,230\n3,6,282~3,8,282\n6,7,267~6,9,267\n2,1,44~3,1,44\n3,8,224~4,8,224\n5,6,41~7,6,41\n7,1,148~7,3,148\n0,6,112~0,8,112\n5,6,298~8,6,298\n1,1,226~1,3,226\n2,0,174~4,0,174\n9,5,25~9,6,25\n0,3,61~0,3,63\n6,4,304~6,8,304\n1,8,112~4,8,112\n5,0,73~5,2,73\n7,9,99~7,9,100\n0,2,276~0,4,276\n3,6,204~3,9,204\n2,6,11~2,6,13\n1,4,263~1,6,263\n3,7,85~3,9,85\n2,5,141~2,7,141\n5,7,262~7,7,262\n3,3,66~3,4,66\n7,4,33~7,6,33\n5,6,237~5,6,240\n5,9,220~7,9,220\n4,6,280~4,7,280\n7,1,280~9,1,280\n1,8,155~3,8,155\n9,5,257~9,6,257\n3,5,110~4,5,110\n3,4,106~5,4,106\n3,6,38~3,8,38\n8,4,158~9,4,158\n9,2,37~9,4,37\n7,5,304~7,7,304\n4,3,284~7,3,284\n4,1,76~5,1,76\n4,8,176~6,8,176\n7,0,178~7,2,178\n0,0,183~0,3,183\n1,6,64~1,8,64\n0,4,42~0,5,42\n4,2,25~7,2,25\n1,8,7~4,8,7\n1,8,183~1,9,183\n6,1,173~6,1,174\n4,0,206~7,0,206\n7,0,121~7,0,123\n2,0,114~2,2,114\n9,5,175~9,7,175\n0,0,102~3,0,102\n9,7,116~9,9,116\n5,6,131~5,7,131\n2,7,236~5,7,236\n6,6,245~9,6,245\n0,0,49~4,0,49\n8,1,161~9,1,161\n2,0,221~2,3,221\n8,1,22~8,4,22\n7,7,162~7,9,162\n5,4,98~5,6,98\n3,1,231~4,1,231\n9,2,225~9,4,225\n0,7,181~0,9,181\n5,5,264~5,7,264\n5,3,195~7,3,195\n7,9,134~9,9,134\n3,4,36~5,4,36\n8,6,30~8,7,30\n0,8,104~0,9,104\n4,0,30~6,0,30\n5,1,90~5,4,90\n7,6,39~7,9,39\n0,0,274~2,0,274\n2,1,106~2,1,109\n5,9,122~5,9,123\n8,6,49~8,6,51\n2,3,87~5,3,87\n6,7,94~6,9,94\n4,3,162~7,3,162\n1,4,151~1,5,151\n4,5,83~8,5,83\n4,0,51~4,0,51\n4,7,58~4,9,58\n2,6,293~4,6,293\n5,2,282~5,5,282\n3,8,133~4,8,133\n7,3,61~8,3,61\n5,9,36~8,9,36\n4,5,230~4,5,233\n3,8,149~3,9,149\n1,4,93~3,4,93\n6,7,228~9,7,228\n0,9,145~1,9,145\n5,4,103~8,4,103\n1,8,292~2,8,292\n3,0,199~4,0,199\n4,7,61~4,7,62\n2,3,280~2,3,283\n3,8,258~3,8,260\n9,2,145~9,2,147\n4,7,297~4,8,297\n3,6,188~3,9,188\n6,6,66~7,6,66\n0,1,230~3,1,230\n8,2,125~8,5,125\n0,6,169~0,6,172\n0,9,245~0,9,247\n1,1,103~2,1,103\n1,0,75~1,2,75\n8,2,150~8,5,150\n2,4,80~5,4,80\n4,2,33~4,2,35\n2,4,206~2,7,206\n5,0,108~7,0,108\n8,1,159~8,2,159\n1,1,199~3,1,199\n8,8,177~9,8,177\n1,1,266~1,3,266\n2,0,31~5,0,31\n7,8,267~7,9,267\n8,0,88~8,3,88\n0,5,282~0,7,282\n5,5,266~7,5,266\n6,0,120~8,0,120\n7,7,230~8,7,230\n7,1,93~7,3,93\n7,3,17~7,3,18\n4,0,287~6,0,287\n1,5,110~2,5,110\n5,4,28~6,4,28\n3,0,34~3,2,34\n5,3,201~6,3,201\n4,3,12~4,3,12\n1,1,95~2,1,95\n2,5,247~2,8,247\n2,8,40~5,8,40\n2,2,113~5,2,113\n6,0,208~8,0,208\n9,5,108~9,7,108\n8,6,215~8,6,217\n3,4,96~3,4,98\n2,2,181~4,2,181\n0,7,105~0,7,107\n6,1,131~8,1,131\n5,0,76~8,0,76\n0,8,138~3,8,138\n2,2,40~2,3,40\n8,6,11~8,8,11\n4,2,294~7,2,294\n1,9,87~4,9,87\n9,4,119~9,4,120\n4,2,297~4,2,298\n3,0,11~3,0,12\n0,1,113~0,1,115\n5,6,293~7,6,293\n1,4,6~4,4,6\n8,5,254~8,7,254\n6,7,33~8,7,33\n7,5,149~7,7,149\n2,6,232~2,6,234\n0,3,301~0,5,301\n5,3,154~5,3,156\n6,1,199~9,1,199\n7,5,218~8,5,218\n9,1,286~9,4,286\n1,6,219~4,6,219\n0,6,5~1,6,5\n5,1,173~5,2,173\n4,1,179~6,1,179\n4,1,203~4,4,203\n5,8,173~8,8,173\n3,1,290~4,1,290\n0,1,293~0,3,293\n8,3,223~8,3,223\n2,0,146~2,2,146\n9,3,52~9,5,52\n5,1,69~5,3,69\n0,6,132~3,6,132\n8,2,127~8,3,127\n5,5,58~7,5,58\n9,3,114~9,3,114\n4,6,155~6,6,155\n8,1,112~8,3,112\n8,4,154~8,5,154\n6,4,112~7,4,112\n8,3,35~8,3,37\n3,1,169~3,3,169\n2,5,1~2,6,1\n1,8,57~4,8,57\n0,5,304~0,7,304\n8,1,167~8,3,167\n8,6,65~8,8,65\n7,7,160~9,7,160\n5,2,151~5,4,151\n4,6,158~6,6,158\n1,4,92~1,6,92\n9,1,97~9,2,97\n4,7,44~4,7,45\n2,7,120~3,7,120\n4,7,291~7,7,291\n1,7,147~1,9,147\n4,7,19~7,7,19\n6,2,64~6,3,64\n1,0,124~1,2,124\n1,2,174~1,2,177\n6,6,92~6,9,92\n2,2,33~2,5,33\n6,7,32~8,7,32\n3,0,196~3,1,196\n1,0,161~1,0,163\n4,2,69~4,3,69\n4,0,111~7,0,111\n4,5,131~6,5,131\n6,5,36~6,7,36\n3,5,16~3,5,19\n5,9,172~7,9,172\n1,4,272~3,4,272\n6,3,120~8,3,120\n3,4,82~3,6,82\n1,3,33~1,5,33\n0,1,182~0,4,182\n5,4,48~5,4,49\n6,7,6~9,7,6\n1,0,69~1,2,69\n2,6,43~2,8,43\n9,5,129~9,8,129\n7,3,109~7,5,109\n8,2,74~8,4,74\n8,4,215~8,5,215\n4,9,206~4,9,206\n0,2,123~3,2,123\n2,1,234~5,1,234\n1,1,1~1,2,1\n1,1,68~1,3,68\n0,8,286~1,8,286\n5,0,16~5,2,16\n0,7,59~0,7,61\n1,3,157~3,3,157\n0,2,184~0,5,184\n0,0,272~0,2,272\n7,0,124~8,0,124\n9,6,261~9,8,261\n9,6,164~9,6,166\n1,3,39~3,3,39\n2,6,203~5,6,203\n3,7,132~3,9,132\n5,5,174~5,6,174\n8,1,82~9,1,82\n2,1,147~4,1,147\n8,9,3~8,9,3\n5,7,81~5,8,81\n2,5,257~5,5,257\n5,5,160~5,6,160\n6,8,276~8,8,276\n4,7,30~4,8,30\n2,1,81~5,1,81\n9,3,256~9,6,256\n7,1,160~9,1,160\n6,2,231~6,2,232\n6,5,242~6,7,242\n8,5,60~9,5,60\n5,6,299~5,8,299\n3,7,146~3,9,146\n0,5,37~0,6,37\n5,5,235~5,8,235\n0,1,30~0,3,30\n7,6,36~7,6,38\n0,3,51~0,5,51\n6,5,175~8,5,175\n0,0,58~0,1,58\n2,8,3~3,8,3\n6,0,91~8,0,91\n6,7,101~6,8,101\n3,3,111~4,3,111\n6,2,228~6,2,230\n1,7,142~1,9,142\n3,4,244~3,5,244\n2,4,114~2,6,114\n6,5,177~8,5,177\n2,5,77~3,5,77\n2,9,175~4,9,175\n2,1,126~2,2,126\n4,4,31~4,4,34\n3,6,5~3,8,5\n6,2,285~6,3,285`;

// part 1
function inputToBricks(input) {
  const bricks = [];
  const lines = input.split('\n');
  for (const line of lines) {
    const [start, end] = line.split('~')
      .map(pos => pos.split(',').map(Number))
      .map(([x,y,z]) => ({x,y,z}));
    const brick = getAxisRange(start, end);
    bricks.push(brick);
  }
  return bricks;
}

function getAxisRange(start, end) {
  const x1 = Math.min(start.x, end.x);
  const y1 = Math.min(start.y, end.y);
  const z1 = Math.min(start.z, end.z);
  const x2 = x1 + Math.abs(start.x - end.x);
  const y2 = y1 + Math.abs(start.y - end.y);
  const z2 = z1 + Math.abs(start.z - end.z);
  return {xAxis: [x1, x2], yAxis: [y1, y2], zAxis: [z1, z2]};
}

function isRangeOverlap(range1, range2) {
  const [min1, max1] = range1;
  const [min2, max2] = range2;
  return min1 <= max2 && max1 >= min2;
}

function getBricks(brick, bricks, getBelow = true) {
  const bricksSet = new Set();
  for (const otherBrick of bricks) {
    if (otherBrick === brick) continue;
    if (getBelow && brick.zAxis[0] - 1 != otherBrick.zAxis[1]) continue;
    if (!getBelow && brick.zAxis[1] + 1 != otherBrick.zAxis[0]) continue;
    if (isRangeOverlap(brick.xAxis, otherBrick.xAxis) && isRangeOverlap(brick.yAxis, otherBrick.yAxis)) {
      bricksSet.add(otherBrick);
    }
  }
  return bricksSet;
}

function tickFallBrick(brick, bricks) {
  if (brick.zAxis[0] <= 1) return false;
  if (getBricks(brick, bricks).size != 0) return false;
  brick.zAxis[0]--;
  brick.zAxis[1]--;
  return true;
}

const bricks = inputToBricks(input);
let atLeastOneFall = true;
while (atLeastOneFall) {
  atLeastOneFall = false;
  for (const brick of bricks) {
    if (!tickFallBrick(brick, bricks)) continue;
    atLeastOneFall = true;
  }
}

for (const brick of bricks) {
  brick.below = getBricks(brick, bricks);
  brick.above = getBricks(brick, bricks, false);
}

let countDisintegrable = 0;
for (const brick of bricks) {
  // for every above brick, check if it has at least one different support brick
  if ([...brick.above].every(b => b.below.size > 1)) countDisintegrable++;
}
console.log(countDisintegrable);

// part 2
let totalFall = 0;
for (const brick of bricks) {
  let hasFall = new Set([brick]);
  let atLeastOneFall = true;
  while (atLeastOneFall) {
    atLeastOneFall = false;
    for (const hasFallBrick of hasFall) {
      for(const otherBrick of hasFallBrick.above){
        if (hasFall.has(otherBrick)) continue;
        // Can fall if all bricks below have already fallen
        if ([...otherBrick.below].every(b => hasFall.has(b))) {
          hasFall.add(otherBrick);
          atLeastOneFall = true;
        }
      }
    }
  }
  totalFall += hasFall.size - 1; // we substract the desintegrated brick
}

console.log(totalFall);