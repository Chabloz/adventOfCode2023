const input =`bl{a<740:ls,gz}\nzms{m>2453:zg,s>3552:jf,lxg}\ngp{m<456:R,a<614:R,R}\ndjm{a<886:A,fch}\nddj{s<2598:fr,x>1640:pkr,sm}\njp{s>3132:R,a<3479:A,R}\ngqx{a>2668:ptn,ddj}\nxk{m>1338:A,R}\ndr{s<2696:R,m>1646:A,x>3598:A,A}\ntpx{a>2236:R,a>2080:A,s<221:A,A}\ncgn{x<669:cd,srb}\nqdp{s<1055:vrk,m<1839:vrh,xzk}\nddb{s<1087:A,x<3390:R,R}\nxp{x>3817:R,x>3641:R,a>3749:R,R}\nksd{a<1094:R,A}\ngz{s<1661:R,m<2157:R,s>1736:R,R}\nch{m>1968:A,pd}\nksj{a<704:A,m<1793:R,a>791:A,A}\njn{s>752:A,A}\ngrd{s<2033:A,A}\ndsn{a<3948:A,m<2179:R,s<3246:R,R}\nffz{m<1620:rfh,s>3418:xx,tbm}\nhnr{x>577:gq,ggh}\nrc{s<1866:bl,pmp}\npcc{x>631:R,R}\nsdb{a<3691:A,x<3761:A,a>3819:R,A}\nngj{m>1731:R,x>432:R,s>291:R,R}\nnq{x<3400:vsv,gjj}\ncq{s<1772:hfv,ffx}\ndn{s<1509:A,m>568:A,R}\nxv{x<2777:mng,m<186:R,fn}\nbf{m>366:R,x<2517:R,a<628:R,A}\ncdv{m>3311:R,s>505:R,m<2631:R,A}\nrb{m<2169:A,R}\nbjj{s>1799:zh,a<491:R,bp}\nkjd{x>3682:R,m<1273:A,R}\ndj{x>1446:A,s<3007:R,R}\nhxj{a<786:R,x<1965:mzv,dhm}\nsf{s<2269:A,m>536:A,R}\njxv{s>3026:qp,hdp}\nrpt{a<1479:qgm,nq}\ncg{a<2358:A,m<3588:A,A}\nrkm{a>2078:A,R}\ntcf{x>3085:R,s>202:cct,a<2608:R,cdc}\ngsz{s>1226:R,a>564:A,m>258:A,A}\nvlh{x>2699:nt,m<3016:ltg,A}\nqz{x>600:R,s>3723:A,a<2679:A,A}\nzm{s<718:R,a<1901:R,A}\nftz{a<1485:mf,m>649:R,R}\njhd{s>2212:R,x>139:A,s<1705:A,R}\npvm{x>3840:R,m>160:R,m>70:R,R}\nnsc{x>347:R,m>2887:R,a>978:A,R}\nkx{a<2774:cdv,m>3081:hlx,R}\nssx{x>3519:R,A}\nlv{x>1891:lkb,x<1813:rs,a<3234:bhx,dc}\nlk{a<3874:R,s>1057:R,a>3945:R,R}\npsv{a<480:A,s<1187:R,m<2683:R,R}\ngjx{s<1104:A,s<1263:A,a<1713:A,A}\nrh{m>2005:A,a>750:A,x>3721:A,R}\njrl{a>1197:A,x<3609:R,R}\npk{s>837:xc,x<2565:R,qg}\njbc{x<1082:R,s<299:lp,A}\nnhq{x<1107:R,R}\nbs{a>1649:A,m<596:A,R}\nhrr{s>674:R,gkm}\ndx{x<3271:dfk,m<3503:lqn,cr}\ntx{a>3035:R,m>398:A,R}\ncv{x<3401:A,R}\nplx{x>1718:cq,x<1532:qn,tn}\nxnb{x>1497:A,R}\nbgg{m<1441:A,a<283:R,A}\nfcs{x<3891:R,x>3938:tvz,cgt}\nlrc{x<2066:R,a<1872:A,A}\ngqj{s>3750:db,rkm}\nsjh{a>1819:R,a>938:dht,tnx}\ncgt{m>959:R,m>427:R,A}\nzr{a>2978:R,A}\nprz{m<2496:tnh,R}\nlr{m>1126:A,a<1470:R,lrc}\nzz{s<1123:R,A}\nfrh{m<2161:A,a<2722:R,m<2337:R,A}\nfv{a<3690:cs,x>3613:A,a>3894:R,A}\nlkh{x<33:A,a>738:A,R}\nqnn{s<2173:A,m<3753:R,m>3898:R,mv}\nrcx{m<2906:R,x<1554:A,R}\nvxm{x<170:A,A}\ndjt{a<1064:R,a<1178:A,R}\nxm{a>951:R,x<3296:R,A}\nsbp{m<593:R,A}\nfzm{x>3289:R,R}\nmvq{m<722:A,R}\ngkm{s>614:A,m<1706:R,x>3018:A,R}\nkpx{s>1291:R,s<1260:R,R}\nfnt{x<3603:A,x<3619:txh,s<236:zr,A}\nrds{s<2082:A,s>2802:pzs,mrp}\ngnh{m>1259:snn,a<2206:zp,a>2473:lgn,pfh}\nvp{s>1857:A,cpd}\nql{x<2703:dm,a>2922:R,m>487:A,lxf}\ngjj{s>3331:A,a>3131:pff,s<3202:prs,mjv}\nsmm{a<561:jhd,x>152:ksj,m>1572:xd,A}\nnb{x<2427:R,a>1733:A,A}\nkzd{x>3127:R,s<366:mt,A}\nhl{x>2233:xnv,bzq}\nvr{s<2109:cmd,a<1852:st,dl}\nzqr{s<1679:R,a<2415:sp,x>2350:hgc,A}\nlct{x>951:R,a<225:A,m>3314:R,R}\npd{x<1905:A,A}\nlm{x<2003:R,A}\nqbl{a>708:djt,A}\nqjh{x>1797:R,x>1612:pzq,R}\ndm{a>2412:R,R}\nbv{a>2013:A,R}\nhgc{s>2957:R,m>497:A,a>2569:A,A}\njc{m<2447:R,A}\nzrh{a>2224:pps,a<1074:fqd,s>1264:qcg,nqg}\nmrp{s>2323:A,s<2219:A,R}\ndtv{x>2225:vz,s<2280:ch,a<3751:crh,dqf}\nlnd{m<1491:R,x>1099:vc,m>1756:R,A}\nxq{m<2910:R,R}\nbnz{s<2727:skm,gh}\nthx{x<1825:R,A}\nvq{s>2011:jlx,R}\nqlr{s>1148:R,x>2237:A,a>2627:R,A}\nbm{m>1911:R,A}\nzpb{m<364:R,a<1495:gpp,sf}\nqg{a>3292:R,m<3271:A,A}\ncct{m<597:A,R}\nxx{s<3616:R,m>2622:A,R}\nfk{m<633:A,m>680:A,A}\npmq{s<2800:R,m>1597:A,s>3285:A,A}\nzg{s>3563:A,a<1375:A,R}\nlf{a<317:R,A}\ntf{m<3570:qcc,x<2624:A,x>2755:A,sgc}\njpl{s<2411:jds,x>3631:xjd,x>3298:A,R}\nkns{s>1061:A,x>3680:R,A}\nmv{x<1604:R,a>1058:R,A}\nlh{x<1510:R,s>2332:R,m>3647:A,R}\nht{m<302:pvm,qlv}\ngj{a>3509:A,R}\ncqb{s<565:dhf,m>545:xn,rsp}\nrm{m>1005:vs,m>829:sl,R}\nmvc{m>717:np,s>1455:R,a<2092:R,R}\njds{s>2325:A,m>2054:R,A}\nbzz{x>3588:A,s>1092:xs,R}\ntj{a<1550:tl,pmq}\ndqf{a<3894:A,m<2033:kp,dsn}\nzb{a<3334:R,m>398:A,R}\nvg{a>925:A,A}\nnlk{s>1315:sr,x<3383:sjh,m>2546:mph,nbj}\ncpd{x>3714:A,x<3543:A,R}\nctc{m>528:zv,s>2378:hl,x>2363:pqq,fhv}\ntrd{a>3676:xq,s>587:gj,sk}\nvs{s>1026:R,x<3197:R,A}\njlz{x>3426:ffn,m>1853:qvm,x>3115:bzk,hrr}\nqhr{a>1146:qd,m>1475:A,m>610:vxm,qm}\nxr{m<944:hzg,ng}\nlg{s<3768:A,R}\nbb{x>224:R,m>2824:R,A}\ncmd{a<1699:R,R}\nngl{s>1243:nlk,a>2337:hlh,m<2840:nhg,pmm}\nhr{m<3263:bnz,tf}\nfhv{x<1791:rg,x<2100:hxj,ngt}\nsms{m>247:R,R}\nqgm{m<2369:mpk,gg}\nxn{a>1391:kgt,qt}\nmg{s<3676:A,A}\nst{a<1529:A,m<1431:bs,R}\nfb{s>271:R,R}\nxgr{m>1747:bb,R}\nzd{s>1545:fg,x<3600:R,A}\ndvn{a<704:nz,s>3045:stj,m<2659:npd,ck}\nstj{s>3461:A,A}\nkgt{m<955:pn,a>2917:hz,gnh}\nzfx{a<3743:A,x<3258:R,R}\nsl{s>1036:R,s<730:R,a<717:A,A}\nfch{s<1133:A,a>1427:R,A}\ndt{x<3370:A,A}\nsr{m>2666:A,x>3567:R,R}\nvzq{m<1340:A,x<3641:R,R}\ncgz{s<802:tsf,m<1174:lk,s<1078:A,crn}\ndrp{m<3554:R,R}\ndhf{x<3393:pgt,x<3762:lx,dk}\nth{x>66:R,R}\npth{x>822:vdr,R}\nntp{a<426:R,a>475:A,s<1910:A,A}\ndmj{s>1097:A,x<3150:A,a>3871:A,A}\nfg{a>2401:A,R}\nbh{a<2532:zbv,a>3289:dtv,a<2990:fq,jxt}\nkbt{x<3466:zfx,x>3761:vm,A}\nqq{s>2397:R,m<3270:R,A}\nmpv{m>3252:A,dpj}\nngt{m>344:gp,m<140:cmq,sms}\nltg{m<2719:A,s<782:A,s<1563:A,A}\nnpd{s<2849:R,x>889:R,A}\nvrh{a>803:A,R}\njql{x>3511:znh,m<3096:kzd,a>3433:sn,vbl}\nhfj{m<1995:A,a<3010:R,m<2185:A,R}\nqzj{m<2953:R,a>3503:R,A}\ntlr{m<933:R,x<986:A,R}\npzs{a<996:R,m<824:A,a>1208:R,A}\ngpp{x>284:A,x<264:A,x<276:R,R}\ntkl{a>891:mx,R}\nvcn{m>2332:qzj,x<486:llc,tlr}\nmx{m>2664:A,x>3311:R,m<1352:R,R}\nnxg{x<1641:R,s>1524:R,thx}\ngv{a<3026:hf,vcn}\nscf{m<1616:R,x<3451:A,x<3810:A,R}\ngbr{m>329:R,s>2994:A,R}\nbzq{x<1715:ft,s>2954:A,s<2585:vfm,R}\njf{x>3150:A,R}\nxvl{m<2873:R,R}\nbfg{m>1674:bh,crm}\nkqn{s<747:hg,x<3131:A,m>162:dt,fzm}\nnbf{m>2296:R,m>2243:R,x>1496:A,A}\nhrj{s>1466:ns,m<1992:qr,jxr}\ntdz{m>3644:R,m>3485:R,s>198:A,R}\ncrm{a>2365:fc,cdm}\nkz{s>3458:lq,s<3088:pvx,rpt}\ndht{m>3146:A,a<1376:A,a>1610:R,A}\ntgh{s<3073:A,x>714:R,a>102:A,R}\njxr{a<3187:kx,s<885:trd,cx}\ndjz{s>994:R,x>3896:R,vlc}\nbpv{x<2576:A,R}\ncc{x<822:R,a>809:A,A}\nqcj{a<2267:R,A}\nqks{a<2138:kxv,A}\nvl{m>1285:A,m>532:A,x>499:dcz,A}\nvsv{x>3203:R,a>2781:sqn,A}\nhn{m<2492:R,s>966:A,a>3721:A,A}\nqcg{x<3381:R,s>1358:ljx,s<1323:A,A}\nhjv{a>1019:hs,s<2509:ltn,m>1900:zn,rp}\ndpj{m<2785:A,R}\nqb{a<2763:A,R}\nsk{x<806:R,m>2763:A,s<384:R,A}\nhq{x<262:A,a>1658:R,R}\nqt{x<3600:rm,m<888:qbl,x<3769:gjm,djz}\njxt{a>3161:vsc,khh}\nrg{s<1498:R,s<1988:A,jzf}\nhb{s<1946:R,x<1431:R,dj}\nggh{s>3012:R,m>1798:R,vk}\nsp{m<335:A,R}\nvlg{x<3108:R,x<3189:R,lg}\nft{a<794:R,x<1516:A,A}\npn{a>2641:R,dmb}\ntsf{s<301:A,a<3867:R,A}\nlxf{s<1070:R,x<2798:A,R}\ncrh{a>3527:A,a>3439:jp,m<2192:A,ms}\njvn{x>3912:A,s>416:A,m<1007:R,A}\nmmd{a>2168:R,A}\nlxg{x>3092:R,a>1449:A,A}\nqj{s>2041:lct,a<217:R,m<3088:bq,drp}\ndmb{m>720:A,R}\nrmg{x<1601:A,m>3795:A,m>3585:R,A}\nrfh{m>703:A,a<1204:R,A}\ngq{m>2025:nhq,a<3261:pz,s<3003:R,zj}\nfr{a<1632:R,a>2200:A,jmj}\nrnj{x>1053:A,a<1927:jc,m>1553:A,A}\nvjf{m>2461:rrr,m>889:bfg,pnc}\ncx{m>2693:A,m>2260:A,A}\npvx{x<3445:bc,drh}\nrsp{s<973:rrs,zrh}\nkss{x<1263:R,R}\nlcs{x>1496:lh,R}\nbq{x>1046:R,R}\ncxm{x<3683:A,A}\nrk{a>835:A,s<762:A,R}\nlvp{x>3731:R,a<3273:A,s>452:A,R}\nffx{a<2120:zcd,A}\nrxf{a<2837:zqr,a>3605:mkf,x>2377:kq,plq}\nin{x<1379:rmb,x<2903:vjf,vjs}\nfh{a<928:R,a<1613:A,x<3461:R,R}\njmj{a>1860:A,m>2981:A,x<1641:A,R}\nvjs{s>2583:kz,s>1430:vj,m>1527:krh,cqb}\nqh{a>2613:R,m<2904:jd,bjh}\nrfc{a>2485:pk,m>3475:dd,a>1183:bj,vlh}\nlp{s>181:R,m>995:A,a<717:R,R}\nfj{x<2030:R,a<641:fk,A}\ngnv{m>149:A,a>1813:R,s<1131:R,R}\nznh{s>363:lvp,a<3331:xvl,xp}\nmvd{s>2001:A,m>2175:nbf,A}\nbzj{a>1037:R,x<3002:A,R}\npjb{a>1949:hmr,A}\nmt{s<308:A,A}\nzjg{m>2458:qc,a>148:A,m<2209:snp,A}\nzch{s>749:A,s>710:R,a<2151:A,A}\nbc{x<3132:jpn,a>2098:bm,tkl}\npz{a>2672:R,m<933:A,s<2981:A,A}\nmh{x<2238:cnq,x<2494:rxf,kg}\ngzr{x>2197:A,A}\nffn{x<3645:ssx,s<649:A,a>701:ksd,br}\nkg{s>2634:kd,s<1625:ql,vq}\nmc{a<3621:R,x>3605:R,A}\nblh{s>2561:nsc,R}\nrr{a<858:cv,R}\nhz{m<1196:R,x>3431:vzq,m<1412:A,vcv}\nhh{x<208:A,x>210:A,A}\ncdc{m<880:R,s>117:R,A}\nmpk{m<1356:R,R}\nzdb{a>2976:R,m<2545:frh,smx}\nprp{a<1715:rh,x<3806:dr,m>1713:brb,mvq}\ntcn{a<1276:R,m<285:R,m>430:R,R}\nkl{x>3357:mc,s>1147:jsg,x>3092:R,A}\nfs{a>862:td,x>78:smm,a>322:ps,tm}\nbbg{a<647:R,R}\njmk{x<146:ffz,x<202:qhr,x<213:nqd,xgr}\ngg{m>3291:R,R}\ndrh{s<2784:prp,m<2166:xk,vvf}\nzvq{m>2315:tt,a<228:tgh,m<2056:R,R}\nbjh{s<603:R,x<3331:R,A}\nssr{a<3041:R,a>3619:A,R}\nhc{a>2881:df,a>2840:R,A}\nxt{a>1936:A,s<1757:R,x>3622:R,A}\nzk{m>621:A,jrl}\ndp{s<511:kgj,m<2474:jlz,vdk}\nkgj{m>2812:kcm,m>2067:prz,rt}\nczb{a>265:R,a>170:R,a>108:A,R}\nkhg{s>1647:R,x<3521:A,a<641:R,A}\npzq{x<1700:A,m<1395:A,A}\ntnx{x>3128:R,x>3018:A,s<1284:A,A}\nbt{m>783:R,R}\nnbj{s>1275:R,x<3645:dhb,m>2106:cb,A}\nvkr{a<1928:fb,m<3262:crv,x>3594:tdz,tpx}\nrrg{a>2541:R,a<2073:A,x<3725:A,R}\nfn{s>1364:A,R}\nlrp{x<3823:A,A}\nhqt{x<2306:jln,s>2054:hr,rfc}\nzp{s<1081:R,R}\nqr{a<3308:vl,a>3642:cgz,s<850:fm,kcv}\ncfm{a>2511:A,s>234:A,R}\njqq{s>2179:tbt,a<3088:rtl,m>1659:hks,xr}\nmjv{x>3745:A,a<2416:R,R}\nrrs{x>3565:ht,m<301:kqn,bnv}\njpg{s<732:A,x>1054:R,A}\nsvq{x<3363:A,s>2291:A,m>1705:R,A}\njsg{m>2516:A,m<1961:R,s<1196:R,A}\ngk{s<2295:R,s<2908:A,m>868:R,A}\nls{a<473:R,khg}\nmj{m<2109:R,A}\ncs{m>2789:A,a<3458:R,x>3521:R,A}\nqd{x<170:A,A}\nhfv{m<3713:cg,R}\nkcv{x>603:A,m>1258:A,a<3455:zz,sbp}\nkq{x>2420:A,a>3137:zb,tx}\nvc{m<1650:R,x>1224:R,x>1164:A,R}\npgt{a>1819:tcf,cj}\nrtg{a>1881:A,x<126:R,R}\nns{m>2579:xb,a<2923:pcc,gzz}\nkrh{s>920:ngl,a<1347:dp,xln}\ngzz{x>624:A,s<2073:A,qzt}\nnqd{a>793:hh,lf}\ncrn{a>3869:A,a>3781:R,R}\nbnv{a>2193:ssr,x>3256:fh,m>386:A,R}\ngxp{x<2496:bbg,R}\nsnn{x<3362:R,x>3742:A,x<3561:R,A}\nncf{s>894:A,R}\nsvc{a<3322:R,s>1985:A,R}\npmp{s>2125:sbh,bpp}\nprs{m>2627:R,a>2521:A,x<3719:A,R}\nxb{a>3349:A,s>1917:R,A}\nxd{a<744:R,A}\nvz{x<2650:R,s>1427:A,tgj}\ndb{s>3871:qcj,s>3800:nc,a<1684:R,rrg}\ntv{x>3867:A,x<3815:qb,R}\ncnq{a>2408:bg,m<416:vzl,x<1755:mvc,pjb}\nlzl{x<1943:A,s>2403:R,s>1025:R,R}\nfp{s>3486:gv,hnr}\nld{x<17:R,m>1748:R,a<108:R,R}\nsbh{a>763:svq,m>2311:qq,bgg}\nzcd{x>1889:A,a<1000:R,A}\ntp{a>629:mcj,s<567:R,czb}\ndts{x<3300:R,m>3459:R,s<744:A,R}\nhmr{m<584:A,s>1688:A,m>719:R,R}\nmfd{m>1773:blh,m>623:cl,x>360:tcn,zpb}\npm{a<3229:rmg,s<2514:A,x<1602:zl,nzb}\nxbl{a<120:A,A}\ncmf{m>1541:A,x<970:bt,gk}\nbrb{m>2948:A,A}\nbj{x>2620:R,m<2855:R,x>2501:zm,nb}\nzpl{x>1871:R,R}\nrt{s>187:R,vzn}\ngh{a>2288:A,m<2746:A,x<2538:R,R}\nkd{s<3284:gbr,s>3668:A,A}\nbx{m>3479:R,R}\nhg{a>1385:A,a>882:A,R}\ntd{s<2374:jh,m<2169:A,x>124:A,A}\npx{s>3344:R,R}\ntm{x<48:ld,s>2327:xbl,m<2038:th,A}\nxnv{a>596:R,R}\nrfd{x>1909:A,A}\nfvp{m>2832:vkr,qks}\njln{a<1424:lj,a>2746:gzr,hms}\nccf{s>2087:R,x<2436:qlr,m>2036:R,A}\nnqg{a<1709:ddb,lpd}\nmr{a<354:R,a<752:csl,a<925:A,A}\nkxv{a>1697:R,a<1525:R,A}\ncb{s>1257:A,a<2181:R,m>2329:A,A}\ntgb{a>2517:R,s<2316:R,mmd}\nzbv{m>2131:mz,x<1966:nxg,njp}\ncnb{a>3209:R,R}\nslg{a<614:R,xm}\nmcj{a>1031:R,m>2915:A,R}\nvvf{s>2919:R,zf}\nck{m<3149:R,a>888:R,R}\nxln{s>497:scv,a<2539:fvp,s<259:qnb,jql}\nll{s<1805:A,m>2559:A,s>1886:A,R}\nlpd{a<1996:A,x>3530:A,x>3313:R,A}\nskm{a>2549:R,x<2676:A,R}\nrn{a<535:R,A}\njkq{x>3569:R,dmj}\nhk{m<2590:A,a<3036:zch,dts}\nmlk{a>3620:hn,x<3583:A,s<976:lrp,nd}\nln{x<3069:A,A}\nzv{m>707:rds,fj}\nvn{s<2102:R,s>2929:R,lm}\nsmx{x<3446:R,m<3108:A,A}\njzf{x<1553:A,R}\nbp{s<1563:A,A}\ntcd{a<1313:R,A}\nnd{m>2702:R,R}\ngr{s>1749:A,R}\nkv{s<1082:nj,m<2461:vfs,psv}\nkhh{a>3065:R,a>3027:lzl,x<2249:R,hfj}\nmb{a<3440:A,a>3635:A,m<2854:A,A}\nxjd{x<3768:A,s>2515:R,R}\nhks{x<3274:mb,s<1692:fv,a<3606:nmh,vp}\ntvz{a<2115:A,R}\nbg{a<2983:A,x<1692:xnb,rfd}\nhf{m<2043:qz,mg}\nng{s<1830:A,A}\njpn{s<2778:R,A}\nvfs{s>1176:A,m<2340:A,R}\ndhm{x<2034:A,a<1284:R,R}\npfh{s<967:R,m>1126:A,R}\njfb{s<3648:zms,vlg}\nhzv{m>1138:scf,A}\nnc{x>3586:R,A}\nllc{m>964:R,A}\nkcm{s>198:R,a<687:A,vg}\ncd{m<1907:ftz,a>1480:gfm,tp}\npp{x<1417:R,s<3664:R,R}\nqvm{a>774:zs,s>736:A,mj}\npps{s<1139:A,A}\nhdb{x<2232:A,s>1890:A,R}\ncnn{a>2526:A,s>1938:bv,s>1803:R,xt}\nsn{s>368:A,s<325:ksm,A}\ncmq{a>661:A,x<2194:R,R}\nksm{a<3657:A,s<293:R,s<313:R,R}\ndfk{a>1457:A,A}\nxc{m<3320:R,m>3716:R,a>3057:R,R}\nrtl{s>1689:cnn,m>2060:zd,hzv}\ndhb{x>3471:R,A}\ndlp{m>2596:A,x<14:R,s>1943:A,A}\ngfm{a>1911:A,s>762:gjx,hq}\nzlt{a>982:R,R}\ncl{s<2562:R,A}\nxj{s>2654:fp,hrj}\nscv{s<681:qh,s<825:hk,s<865:rv,ncf}\njld{a>1434:A,x<3714:A,A}\nzj{s<3259:R,a>3744:A,A}\nph{x>2211:A,R}\nlqn{x>3735:R,R}\nbkk{a>2188:xh,A}\nnt{m<2925:A,a>726:R,x<2823:A,R}\ndk{s<331:fcs,a>1598:tv,a<1016:mr,tgx}\nfqd{x>3449:jx,gsz}\nplq{x<2328:svc,A}\nlgn{s>958:A,m>1129:A,R}\nmf{s<734:A,m>657:A,R}\npnc{a<1604:ctc,mh}\nlj{x<2126:A,hdb}\ntt{s>3476:A,m<2634:R,A}\nqk{s>3118:kss,m<1971:A,x<1189:A,A}\nfq{a>2786:hc,x>1900:ccf,x>1608:mft,mvd}\nsdc{m>1942:R,A}\nrbb{m<1440:R,a<2999:A,s<1690:A,A}\nvk{s>2863:A,a<3068:R,R}\njx{m<360:R,a>499:A,a>284:A,A}\nzq{s<1379:cgn,x>493:hjv,tz}\ndv{m<2557:R,x>128:R,A}\ndf{s<1859:A,A}\nmft{x<1710:A,rb}\nsz{a>1380:R,A}\nvdr{a<161:A,m>3660:R,A}\nkvz{x<3089:A,m<3794:A,A}\npkr{x<1763:R,m<2850:R,sz}\njd{x<3597:A,x>3754:A,m>2378:A,R}\nbpp{x>3322:A,A}\nhdp{s<2439:R,R}\nxs{s<1184:A,A}\nqp{s<3554:A,x>939:A,R}\nsnp{x<1068:R,R}\ntxh{a>2926:R,s<262:R,s>437:A,R}\nnz{a>540:R,R}\npff{m<2253:R,s>3227:R,x<3740:R,A}\nvm{x<3897:A,R}\nsgc{s>3069:A,x>2704:R,A}\nhs{x<846:tj,x>1038:qk,a>1562:jxv,cmf}\njh{x<139:R,A}\nms{a>3343:R,A}\nlx{x<3551:tg,x>3641:lc,a<2158:zk,fnt}\nvbl{x>3283:A,a>2905:A,m<3688:ln,kvz}\nvj{a>1543:jqq,rc}\nsm{s<3405:R,m>2826:tcd,x<1492:pp,R}\nrv{a>2245:A,R}\ncr{a<1551:A,R}\npmm{s<1038:dx,djm}\ntgj{x<2794:R,R}\nbhx{x<1864:R,m<3077:R,A}\nvfm{a>1015:R,a<550:A,x<1923:A,A}\nnzb{x>1671:A,a>3563:R,a>3448:A,R}\nnhg{a>1228:bzz,m>2136:kv,x<3573:slg,qdp}\nkrk{m<1948:R,x<2305:R,A}\ndd{s<1338:R,s<1588:A,R}\nzn{a>345:dvn,m>3068:pth,x>881:zjg,zvq}\nmng{a<889:R,s>875:R,a<1145:A,A}\njjb{a>2554:A,m<2948:A,A}\nhms{x<2107:gr,a<1892:A,bx}\ntbm{a>798:R,m<2506:R,s<3237:R,A}\nxzk{a>608:R,x<3784:A,a>299:A,A}\ntbt{a>3178:jpl,tgb}\nmph{m>3167:kpx,x<3613:A,s<1278:jjb,A}\ndl{a>2025:R,s<2542:R,a<1914:rtg,dv}\njz{s>984:A,a>492:jpg,m>1537:sdc,A}\nrrr{x>1981:hqt,m>3434:plx,gqx}\nqcc{s<2722:A,x<2559:A,R}\ncj{x<3076:bzj,A}\nmzv{x>1888:R,s>1142:R,m<265:A,R}\nvdk{s>726:rr,prx}\nzh{m<1528:A,x<834:A,A}\nbr{m>1925:A,A}\nvsc{x>2084:cnb,s>1639:ss,jn}\nfc{x<2073:qjh,fd}\nvzl{a>2039:R,s<1842:gnv,zpl}\nljx{x<3776:R,a>1629:A,s>1384:A,R}\nrmb{a<2249:zq,xj}\ntl{a>1366:R,R}\ndcz{x>1062:R,A}\nqc{a>126:A,A}\nbps{m>1116:A,x<3705:A,x<3741:R,R}\ncdm{m<1375:lr,vn}\ncsl{m>689:R,x<3860:R,x<3942:A,A}\nzl{a<3705:A,R}\ntz{x>231:mfd,s>2911:jmk,a>1359:vr,fs}\nqzt{a<3541:A,s<2429:A,x>250:A,A}\nmmk{x>3295:A,a>2774:A,R}\nlkb{m>2866:A,m>2731:R,m>2590:R,A}\nbzk{m<1697:rk,R}\nmkf{x<2340:dlz,dn}\nqn{x>1476:lcs,m>3644:hb,bkk}\nnmh{s<2005:ll,s>2075:A,A}\npvt{a<2021:A,R}\ntg{x<3486:R,x>3520:A,m<614:pvt,cfm}\ncms{m<1017:A,A}\nnp{m>793:A,R}\nhd{a<601:km,A}\nvlc{s>776:R,s<692:R,m>1211:R,R}\ntnh{x<3444:A,x>3657:R,x>3571:R,A}\ndc{x>1856:A,R}\nprx{x<3308:A,R}\npnp{a<3681:R,a<3877:R,A}\nsqn{m<1376:R,A}\nltn{m<2580:bjj,a<445:qj,m>3326:cc,grd}\nqm{s>3408:A,m>266:R,s<3157:R,A}\nhzg{m>566:pnp,x<3524:A,sdb}\nptn{x>1715:lv,rcx}\nfd{s>2317:R,s<1077:R,m>1190:rbb,R}\nvcv{s>1085:R,m<1459:A,A}\nnjp{s<2008:bpv,krk}\nvrk{m>1791:R,A}\npl{m>700:A,R}\nzf{s>2859:R,A}\nnj{x<3501:A,R}\nlq{x>3276:gqj,jfb}\ntgx{a<1316:A,a<1470:jvn,A}\ndlz{x>2302:R,x>2266:R,R}\nzs{a<1003:R,s<652:A,x<3108:R,A}\nlc{m<715:jld,m>1228:cxm,A}\nps{a>555:lkh,x>27:ntp,dlp}\nqlv{a>2107:A,m<429:R,s<765:A,A}\nmz{s<2198:ph,a<1510:A,s<3113:A,A}\nhlh{a<3441:mmk,a>3795:jkq,s>1055:kl,mlk}\npqq{x>2596:xv,s>1190:md,gxp}\nrs{m>2900:A,m>2661:R,a>3541:R,R}\nxh{s<2644:R,s>3099:A,s<2869:R,A}\nkm{m<684:R,R}\nrp{x<897:qhx,m<1266:hd,a>416:lnd,px}\nqnb{a<3461:zdb,kbt}\nfm{x>872:pl,m>1280:ngj,m<657:R,cms}\ncrv{a>2194:A,m>3050:A,x<3524:R,A}\nss{a<3226:R,x<1729:R,s<2485:R,A}\nmd{m<217:zlt,bf}\nsrb{a>1332:rnj,m>2431:mpv,s>510:jz,jbc}\nvzn{x<3294:A,x>3656:R,x>3490:R,A}\nqhx{x<672:A,s<3170:A,s>3459:rn,R}\nhlx{m>3560:A,m<3264:R,a>3022:A,R}\njlx{x>2704:R,s>2411:R,a<2472:A,R}\ntn{a<2648:qnn,pm}\nkp{a<3948:R,m<1820:A,m>1958:A,A}\ngjm{a<671:bps,a<1025:kns,kjd}\n\n{x=284,m=1891,a=2802,s=1569}\n{x=420,m=57,a=2230,s=462}\n{x=39,m=8,a=1100,s=2896}\n{x=1870,m=1242,a=578,s=501}\n{x=1206,m=3725,a=3,s=1411}\n{x=2376,m=1197,a=453,s=88}\n{x=1184,m=1947,a=105,s=645}\n{x=1442,m=1024,a=1435,s=625}\n{x=581,m=2649,a=83,s=275}\n{x=2882,m=1328,a=1730,s=1711}\n{x=434,m=636,a=320,s=1480}\n{x=311,m=1245,a=1125,s=166}\n{x=66,m=1973,a=1905,s=1878}\n{x=1023,m=686,a=2700,s=193}\n{x=252,m=1312,a=613,s=2349}\n{x=3654,m=311,a=394,s=89}\n{x=865,m=27,a=1429,s=1221}\n{x=438,m=2777,a=1947,s=2550}\n{x=45,m=1736,a=214,s=20}\n{x=427,m=750,a=737,s=292}\n{x=458,m=158,a=186,s=98}\n{x=420,m=2448,a=311,s=2044}\n{x=3669,m=231,a=558,s=846}\n{x=193,m=166,a=1107,s=104}\n{x=19,m=1284,a=209,s=1836}\n{x=995,m=1129,a=1449,s=1583}\n{x=1539,m=2093,a=3751,s=817}\n{x=994,m=694,a=9,s=2118}\n{x=140,m=2235,a=845,s=22}\n{x=1254,m=350,a=1620,s=525}\n{x=1172,m=152,a=1070,s=602}\n{x=275,m=3148,a=115,s=11}\n{x=168,m=2316,a=3183,s=687}\n{x=550,m=1657,a=360,s=2283}\n{x=2268,m=572,a=2411,s=1435}\n{x=1441,m=652,a=1593,s=316}\n{x=371,m=492,a=269,s=2100}\n{x=1704,m=2240,a=664,s=763}\n{x=594,m=2838,a=2114,s=93}\n{x=195,m=286,a=948,s=160}\n{x=1727,m=2398,a=672,s=530}\n{x=1431,m=1,a=1096,s=209}\n{x=499,m=280,a=831,s=915}\n{x=2517,m=1095,a=200,s=439}\n{x=2244,m=371,a=457,s=350}\n{x=2184,m=67,a=37,s=113}\n{x=363,m=1478,a=1770,s=697}\n{x=196,m=2565,a=266,s=2016}\n{x=2909,m=193,a=9,s=2397}\n{x=446,m=1000,a=3537,s=925}\n{x=472,m=1044,a=193,s=2764}\n{x=1015,m=50,a=1955,s=189}\n{x=422,m=65,a=1044,s=2834}\n{x=299,m=1258,a=1384,s=1725}\n{x=18,m=2245,a=1949,s=531}\n{x=1501,m=2178,a=53,s=713}\n{x=1988,m=857,a=235,s=177}\n{x=376,m=400,a=2263,s=401}\n{x=1173,m=349,a=550,s=926}\n{x=2265,m=716,a=1234,s=129}\n{x=208,m=89,a=1521,s=51}\n{x=1972,m=794,a=871,s=2098}\n{x=110,m=39,a=2148,s=1980}\n{x=40,m=120,a=344,s=2202}\n{x=508,m=901,a=297,s=186}\n{x=3661,m=670,a=537,s=2042}\n{x=53,m=515,a=501,s=377}\n{x=209,m=650,a=709,s=887}\n{x=1228,m=3064,a=1205,s=153}\n{x=1263,m=925,a=350,s=1064}\n{x=1194,m=689,a=3219,s=1970}\n{x=348,m=724,a=764,s=2290}\n{x=1408,m=3130,a=20,s=590}\n{x=1243,m=21,a=1674,s=71}\n{x=692,m=2323,a=1155,s=871}\n{x=1358,m=2923,a=42,s=1744}\n{x=854,m=242,a=279,s=750}\n{x=113,m=67,a=1339,s=402}\n{x=1090,m=19,a=878,s=3656}\n{x=213,m=2002,a=841,s=1026}\n{x=1119,m=1507,a=1479,s=460}\n{x=837,m=1811,a=744,s=2179}\n{x=976,m=1316,a=838,s=103}\n{x=1461,m=456,a=1380,s=36}\n{x=1502,m=774,a=160,s=858}\n{x=2211,m=7,a=10,s=111}\n{x=1354,m=38,a=1899,s=951}\n{x=941,m=134,a=439,s=1199}\n{x=934,m=765,a=190,s=731}\n{x=266,m=1337,a=963,s=796}\n{x=2128,m=578,a=935,s=681}\n{x=2500,m=2062,a=477,s=855}\n{x=607,m=1511,a=200,s=1405}\n{x=143,m=2282,a=1498,s=267}\n{x=541,m=1055,a=494,s=68}\n{x=2503,m=274,a=419,s=799}\n{x=358,m=2411,a=357,s=923}\n{x=2115,m=778,a=179,s=193}\n{x=1732,m=2267,a=1177,s=2940}\n{x=575,m=2495,a=73,s=264}\n{x=581,m=213,a=2494,s=1329}\n{x=1588,m=1145,a=576,s=20}\n{x=108,m=1989,a=219,s=1064}\n{x=218,m=615,a=550,s=999}\n{x=903,m=454,a=627,s=107}\n{x=216,m=80,a=56,s=2320}\n{x=66,m=1028,a=788,s=2597}\n{x=772,m=50,a=1484,s=1603}\n{x=1439,m=763,a=1467,s=2211}\n{x=544,m=2582,a=429,s=203}\n{x=37,m=498,a=33,s=45}\n{x=1641,m=1208,a=764,s=1803}\n{x=493,m=2581,a=2494,s=122}\n{x=670,m=758,a=1174,s=1589}\n{x=3,m=460,a=967,s=106}\n{x=184,m=420,a=3047,s=3434}\n{x=585,m=1388,a=462,s=445}\n{x=1136,m=2686,a=455,s=1090}\n{x=3416,m=898,a=621,s=931}\n{x=1568,m=1200,a=710,s=339}\n{x=1864,m=410,a=3287,s=877}\n{x=1615,m=317,a=664,s=169}\n{x=1045,m=459,a=2569,s=620}\n{x=1160,m=467,a=1299,s=2239}\n{x=1005,m=2694,a=660,s=427}\n{x=180,m=170,a=696,s=1564}\n{x=43,m=988,a=2158,s=1431}\n{x=121,m=22,a=627,s=81}\n{x=1981,m=252,a=2223,s=1291}\n{x=252,m=789,a=338,s=927}\n{x=173,m=442,a=7,s=3181}\n{x=1694,m=619,a=1602,s=604}\n{x=986,m=1405,a=1,s=149}\n{x=1060,m=40,a=304,s=2536}\n{x=5,m=56,a=68,s=467}\n{x=942,m=2052,a=457,s=310}\n{x=6,m=31,a=13,s=917}\n{x=1407,m=1190,a=1181,s=1529}\n{x=635,m=1244,a=2045,s=2412}\n{x=1680,m=102,a=1084,s=2704}\n{x=29,m=104,a=666,s=2041}\n{x=2794,m=547,a=833,s=515}\n{x=115,m=339,a=2142,s=1185}\n{x=612,m=844,a=1763,s=484}\n{x=7,m=151,a=116,s=45}\n{x=2247,m=93,a=2768,s=72}\n{x=733,m=220,a=2793,s=355}\n{x=2537,m=1549,a=173,s=2928}\n{x=1404,m=1352,a=24,s=383}\n{x=43,m=1465,a=216,s=1053}\n{x=233,m=61,a=583,s=50}\n{x=186,m=2087,a=126,s=2177}\n{x=205,m=1163,a=1743,s=2851}\n{x=681,m=554,a=7,s=1124}\n{x=626,m=1328,a=199,s=320}\n{x=403,m=1734,a=774,s=2206}\n{x=176,m=3244,a=652,s=428}\n{x=3086,m=109,a=468,s=1578}\n{x=3710,m=814,a=29,s=1741}\n{x=228,m=632,a=805,s=435}\n{x=182,m=1078,a=948,s=143}\n{x=77,m=46,a=359,s=2065}\n{x=1513,m=922,a=797,s=1760}\n{x=1168,m=740,a=699,s=313}\n{x=142,m=643,a=1659,s=1070}\n{x=1595,m=2017,a=1386,s=1293}\n{x=945,m=2192,a=1526,s=103}\n{x=30,m=12,a=1223,s=1089}\n{x=656,m=378,a=275,s=112}\n{x=180,m=2064,a=1174,s=1411}\n{x=3026,m=155,a=452,s=361}\n{x=149,m=476,a=1765,s=2870}\n{x=1681,m=556,a=87,s=2109}\n{x=351,m=42,a=1577,s=190}\n{x=2565,m=58,a=116,s=2949}\n{x=1819,m=2226,a=1267,s=1560}\n{x=3628,m=487,a=2135,s=2160}\n{x=132,m=212,a=555,s=2597}\n{x=749,m=252,a=216,s=1027}\n{x=2728,m=1058,a=2257,s=340}\n{x=2261,m=405,a=558,s=46}\n{x=1850,m=262,a=533,s=739}\n{x=32,m=1065,a=2173,s=471}\n{x=265,m=1801,a=228,s=700}\n{x=1163,m=482,a=2031,s=577}\n{x=1334,m=397,a=454,s=313}\n{x=3177,m=267,a=2244,s=730}\n{x=254,m=1944,a=1654,s=103}\n{x=11,m=3129,a=1055,s=63}\n{x=1421,m=144,a=205,s=382}\n{x=1222,m=977,a=249,s=2551}\n{x=692,m=1016,a=465,s=45}\n{x=1919,m=590,a=1385,s=215}\n{x=856,m=639,a=126,s=827}\n{x=27,m=1509,a=61,s=316}\n{x=2661,m=922,a=82,s=848}\n{x=2146,m=100,a=1739,s=351}\n{x=1623,m=430,a=234,s=357}\n{x=967,m=748,a=74,s=63}\n{x=1665,m=716,a=88,s=358}`;

function inputToRulesAndParts(input) {
  const data = input.split('\n\n');
  const workflows = new Map();
  for (const line of data[0].split('\n')) {
    const [name, rulesData] = line.split('{');
    const rulesInfo = rulesData.replace('}', '').split(',');
    const defaultDest = rulesInfo.pop();
    const rules = [];
    for (const rule of rulesInfo) {
      const [cond, dest] = rule.split(':');
      rules.push({cond, dest});
    }
    workflows.set(name, {name, rules, defaultDest});
  };
  const parts = [];
  for (const line of data[1].split('\n')) {
    const part = {};
    for (const data of line.replace('{', '').replace('}', '').split(',')) {
      const [key, value] = data.split('=');
      part[key] = parseInt(value);
    }
    parts.push(part);
  };
  return {workflows, parts};
}

// part 1
const REJECTED = 'R';
const ACCEPTED = 'A';
const accepeted = new Set();
const {workflows, parts} = inputToRulesAndParts(input);
workflows.set(ACCEPTED, {name: ACCEPTED});
workflows.set(REJECTED, {name: REJECTED});

for (const part of parts) {
  let cur = workflows.get('in');
  const {x, m, a, s} = part;
  while (cur.name !== ACCEPTED && cur.name !== REJECTED) {
    let next = cur.defaultDest;
    for (const {cond, dest} of cur.rules) {
      if (eval(cond)) {
        next = dest;
        break;
      }
    }
    cur = workflows.get(next);
  }
  if (cur.name === ACCEPTED) accepeted.add(part);
}

console.log([...accepeted].reduce((acc, part) => acc + part.x + part.m + part.a + part.s, 0));

// Part 2
const queue = [{
  workflow: 'in',
  xMin: 1, xMax: 4000,
  mMin: 1, mMax: 4000,
  aMin: 1, aMax: 4000,
  sMin: 1, sMax: 4000,
}];
let combinations = 0;
while(queue.length > 0) {
  let curPart = queue.shift()
  if (curPart.workflow == ACCEPTED) {
    combinations += (1 + curPart.xMax - curPart.xMin) * (1 + curPart.mMax - curPart.mMin) * (1 + curPart.aMax - curPart.aMin) * (1 + curPart.sMax - curPart.sMin);
    continue;
  };
  if (curPart.workflow == REJECTED) continue;
  const workflow = workflows.get(curPart.workflow);
  curPart = { ...curPart, workflow:  workflow.defaultDest };
  queue.push(curPart);
  for (const rule of workflow.rules) {
    const {cond, dest} = rule;
    const [cat, op, ...valueDigit] = cond.split('');
    const value = Number(valueDigit.join(''));
    const nextPart = { ...curPart, workflow: dest};
    if (op == '<') {
      nextPart[`${cat}Max`] = Math.min(nextPart[`${cat}Max`], value - 1);
      curPart[`${cat}Min`] = Math.max(curPart[`${cat}Min`], nextPart[`${cat}Max`] + 1);
    } else {
      nextPart[`${cat}Min`] = Math.max(nextPart[`${cat}Min`], value + 1);
      curPart[`${cat}Max`] = Math.min(curPart[`${cat}Max`], nextPart[`${cat}Min`] - 1);
    }
    queue.push(nextPart);
  }
}
console.log(combinations);