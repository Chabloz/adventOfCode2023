const input = `\n#.###########################################################################################################################################\n#.#.......#...###.....#.........#...#.......#...###.......#...###.......#...#...#...#.....#.....#.....#.........###.....###...#...#...#...###\n#.#.#####.#.#.###.###.#.#######.#.#.#.#####.#.#.###.#####.#.#.###.#####.#.#.#.#.#.#.#.###.#.###.#.###.#.#######.###.###.###.#.#.#.#.#.#.#.###\n#.#.#.....#.#...#.#...#.#.......#.#.#.#.....#.#.#...#...#...#...#.....#.#.#...#.#.#.#.#...#.#...#.#...#.......#...#.#...#...#...#.#.#.#.#...#\n#.#.#.#####.###.#.#.###.#.#######.#.#.#.#####.#.#.###.#.#######.#####.#.#.#####.#.#.#.#.###.#.###.#.#########.###.#.#.###.#######.#.#.#.###.#\n#...#.#...#.#...#.#.....#.#...###.#.#.#.###...#.#.#...#.#.......#...#.#.#.#.....#.#...#.#...#...#.#.#.....###...#.#.#...#.#.......#.#.#.#...#\n#####.#.#.#.#.###.#######.#.#.###.#.#.#.###.###.#.#.###.#.#######.#.#.#.#.#.#####.#####.#.#####.#.#.#.###.#####.#.#.###.#.#.#######.#.#.#.###\n#.....#.#.#.#...#.....#...#.#...#.#.#.#...#...#.#...#...#.>.>.....#.#.#.#.#...>.>.#.....#.#.....#.#.#...#.###...#.#...#.#.#.#...###.#.#.#.###\n#.#####.#.#.###.#####.#.###.###.#.#.#.###.###.#.#####.#####v#######.#.#.#.#####v###.#####.#.#####.#.###.#.###.###.###.#.#.#.#.#.###.#.#.#.###\n#...#...#.#.#...#...#.#.###...#.#.#.#...#.#...#...#...#####.......#.#.#.#...#...###.###...#.......#...#.#...#...#.#...#.#.#.#.#.#...#.#.#...#\n###.#.###.#.#.###.#.#.#.#####.#.#.#.###.#.#.#####.#.#############.#.#.#.###.#.#####.###.#############.#.###.###.#.#.###.#.#.#.#.#.###.#.###.#\n#...#.#...#.#...#.#.#.#.#...#.#.#.#.>.>.#...#.....#.....#.........#...#.#...#.#...#...#...#...........#...#.#...#.#...#.#.#.#.#.#.#...#.#...#\n#.###.#.###.###.#.#v#.#.#.#.#.#.#.###v#######.#########.#.#############.#.###.#.#.###.###.#.#############.#.#.###.###.#.#.#.#.#.#.#.###.#.###\n#...#.#...#.#...#.#.>.#.#.#.#.#...###.......#.#...#.....#...........###...###...#...#...#.#.#...###...#...#...###.....#.#.#.#.#.#.#...#.#...#\n###.#.###.#.#.###.#v###.#.#.#.#############.#.#.#.#.###############.###############.###.#.#.#.#.###.#.#.###############.#.#.#.#.#.###.#.###.#\n###.#.###...#.....#...#.#.#...#.............#...#...#.........#...#...#.............###...#...#...#.#.#...#...........#.#.#...#...###...#...#\n###.#.###############.#.#.#####.#####################.#######.#.#.###.#.#########################.#.#.###.#.#########.#.#.###############.###\n###.#...#.............#...#.....#.......#####...#.....#.....#...#.....#.....#...#...#...#.........#.#.###...#...#...#.#.#...#.....#.......###\n###.###.#.#################.#####.#####.#####.#.#.#####.###.###############.#.#.#.#.#.#.#.#########.#.#######.#.#.#.#.#.###.#.###.#.#########\n###.....#...............###.......#...#...#...#.#.#.....#...###.........###...#...#...#.#.#...#...#.#...#.>.>.#...#...#.....#...#...#.......#\n#######################.###########.#.###.#.###.#.#.#####.#####.#######.###############.#.#.#.#.#.#.###.#.#v###################.#####.#####.#\n#.......#.....#.........#...#.......#.....#.#...#...#...#.......#...#...#...............#.#.#.#.#...#...#.#.#...#...#.........#.#...#.#.....#\n#.#####.#.###.#.#########.#.#.#############.#.#######.#.#########.#.#.###.###############.#.#.#.#####.###.#.#.#.#.#.#.#######.#.#.#.#.#.#####\n#.....#.#...#...#...#...#.#.#.......#.......#.....#...#...........#.#.###...#...#...#...#...#.#.....#.....#...#...#...#.......#.#.#...#.....#\n#####.#.###.#####.#.#.#.#.#.#######.#.###########.#.###############.#.#####.#.#.#.#.#.#.#####.#####.###################.#######.#.#########.#\n#...#.#.###.......#.#.#.#.#.#...#...#.#.........#.#...#...........#.#.#...#...#...#...#.....#.#...#.#####.....#...#...#.......#...###...#...#\n#.#.#.#.###########.#.#.#.#.#.#.#.###.#.#######.#.###.#.#########.#.#.#.#.#################.#.#.#.#.#####.###.#.#.#.#.#######.#######.#.#.###\n#.#...#.#...#.......#.#.#.#.#.#.#.....#...#...#...###...###.......#.#.#.#.............#...#.#.#.#...#.....###...#...#.#.......#.......#...###\n#.#####.#.#.#.#######.#.#.#.#.#.#########.#.#.#############.#######.#.#.#############.#.#.#.#.#.#####.###############.#.#######.#############\n#.#...#...#...#...###.#.#.#.#.#.#...###...#.#.#...###...#...#.....#...#.........#...#...#...#.#.#.....#...#...#...###...###...#.............#\n#.#.#.#########.#.###.#.#.#.#.#.#.#.###v###.#.#.#.###.#.#.###.###.#############.#.#.#########.#.#.#####.#.#.#.#.#.#########.#.#############.#\n#.#.#.#.......#.#...#.#.#.#.#.#.#.#.#.>.>.#.#.#.#.###.#.#...#...#...#...#...###...#.....#...#...#...#...#...#...#.....#...#.#.#.............#\n#.#.#.#.#####.#.###.#.#.#.#.#.#.#.#.#.#v#.#.#.#.#.###.#.###v###.###.#.#.#.#.###########.#.#.#######.#.###############.#.#.#.#.#.#############\n#...#...#...#.#...#...#.#.#.#.#...#...#.#.#.#.#.#...#.#.#.>.>.#.#...#.#.#.#.###.......#...#...#.....#.#.....#...#...#.#.#.#.#.#.............#\n#########.#.#.###.#####.#.#.#.#########.#.#.#.#.###.#.#.#.#v#.#.#.###.#.#.#.###.#####.#######.#.#####.#.###.#.#.#.#.#.#.#.#.#.#############.#\n#.........#...###.....#.#.#.#...#.......#...#...###...#...#.#...#.#...#...#...#.....#.........#.......#...#...#...#...#.#...#.###...#.......#\n#.###################.#.#.#.###.#.#########################.#####.#.#########.#####.#####################.#############.#####.###.#.#.#######\n#.............###.....#.#.#.#...#...............#.......#...#.....#.#...#.....#...#.............#...#...#.........#...#.....#.#...#.#.......#\n#############.###.#####.#.#.#.#################.#.#####.#.###.#####.#.#.#.#####.#.#############.#.#.#.#.#########.#.#.#####.#.#.###.#######.#\n#.............#...#.....#.#...#...........#.....#.....#.#...#...#...#.#...#...#.#.#...#.........#.#...#.#.........#.#.#...#.#.#...#.#...#...#\n#.#############.###.#####.#####.#########.#.#########.#.###.###.#.###.#####.#.#.#.#.#.#v#########.#####.#.#########.#.#.#.#.#.###.#.#.#.#v###\n#.........###...###.....#.....#.....#...#...#.........#.#...#...#.###...#...#.#.#.#.#.>.>.#...###...#...#.#.....#...#.#.#.#.#...#.#.#.#.>.###\n#########v###.#########.#####.#####.#.#.#####.#########.#.###.###.#####.#.###.#.#.#.###v#.#.#.#####.#.###v#.###.#.###.#.#.#.###.#.#.#.###v###\n#.......#.>...#...#...#.......#.....#.#...#...#...#...#.#...#...#...#...#...#...#...#...#.#.#...#...#...>.>.#...#.#...#.#...###.#.#...###.###\n#.#####.#v#####.#.#.#.#########.#####.###.#.###.#.#.#.#.###.###.###.#.#####.#########.###.#.###.#.#######v###.###.#.###.#######.#.#######.###\n#.....#.#.......#.#.#.#...#...#.#.....#...#.....#...#.#.#...#...#...#.......#.........###...###.#.....#...###.#...#...#.......#...###...#...#\n#####.#.#########.#.#.#.#.#.#.#.#.#####.#############.#.#.###.###.###########.#################.#####.#.#####.#.#####.#######.#######.#.###.#\n#.....#...........#.#...#.#.#.#...#.....###...........#...###.....###.......#.#...............#.......#.....#...#####...#.....#.......#...#.#\n#.#################.#####.#.#.#####.#######.#########################.#####.#.#.#############.#############.###########.#.#####.#########.#.#\n#.........#...#...#.....#.#.#.#...#.......#.......................#...#.....#...#.......#...#.###...#.......###...###...#...###.........#.#.#\n#########.#.#.#.#.#####.#.#.#.#.#.#######.#######################.#.###.#########.#####.#.#.#.###.#.#.#########.#.###.#####.###########.#.#.#\n#.........#.#.#.#.#.....#.#.#.#.#.........###...#####...#.........#...#.###...###.....#.#.#...#...#.#...........#...#.#.....#.....###...#...#\n#.#########.#.#.#.#.#####.#.#.#.#############.#.#####.#.#.###########.#.###.#.#######.#.#.#####.###.###############.#.#.#####.###.###.#######\n#...#.....#.#.#.#.#.....#.#.#.#.....###...###.#.#.....#...#...#...#...#...#.#.#...###.#...#...#...#.#.........#...#.#...#...#...#.....#.....#\n###.#.###.#.#.#.#.#####.#.#.#.#####v###.#.###.#.#.#########.#.#.#.#.#####.#.#.#.#.###v#####.#.###.#.#.#######.#.#.#.#####.#.###.#######.###.#\n###...###.#.#.#.#.#...#.#.#.#.#...>.>...#.....#.#.........#.#.#.#.#...#...#.#...#...>.>.#...#.#...#.#...#...#...#...#...#.#.###.......#.#...#\n#########.#.#.#.#v#.#.#.#.#.#.#.###v###########.#########.#.#.#.#.###.#.###.#########v#.#.###.#.###.###v#.#.#########.#.#.#.#########.#.#.###\n#...#.....#.#...#.>.#.#.#.#.#.#.###...#.......#.#.........#.#.#.#.#...#...#.#.....#...#.#...#.#...#...>.>.#.....#...#.#.#.#.#...#...#...#...#\n#.#.#.#####.#####v###.#.#.#.#.#.#####.#.#####.#.#.#########.#.#.#.#.#####.#.#.###.#.###.###.#.###.#####v#######.#.#.#.#.#.#.#.#.#.#.#######.#\n#.#.#.......#.....###...#.#.#...#...#.#.#...#...#.....#...#.#.#.#.#.....#...#...#.#.###.....#.#...###...#.......#.#.#.#.#.#.#.#.#.#.#.....#.#\n#.#.#########.###########.#.#####.#.#.#.#.#.#########.#.#.#.#.#.#.#####.#######.#.#.#########.#.#####.###.#######.#.#.#.#.#.#.#.#.#.#v###.#.#\n#.#...#...###...#.....#...#...#...#...#...#...###...#...#.#.#.#.#...#...#.......#...#...#.....#.#.....###.#...#...#...#.#.#...#...#.>.###.#.#\n#.###.#.#.#####.#.###.#.#####.#.#############.###.#.#####.#.#.#.###.#.###.###########.#.#.#####.#.#######.#.#.#.#######.#.###########v###.#.#\n#...#...#.#...#.#.#...#.......#.........#...#...#.#.#.....#.#...###.#...#.............#.#.....#.#.......#.#.#.#.....###.#...#.......#.###...#\n###.#####.#.#.#.#.#.###################.#.#.###.#.#.#.#####.#######.###.###############.#####.#.#######.#.#.#.#####.###.###.#.#####.#.#######\n###...#...#.#.#...#.......#.............#.#.###.#.#.#.#...#.......#...#.#.............#.....#...#.......#...#...#...#...#...#.....#.#.......#\n#####.#.###.#.###########.#.#############.#.###.#.#.#v#.#.#######.###.#.#.###########.#####.#####.#############.#.###.###.#######.#.#######.#\n#.....#.....#...#...#.....#...#...........#...#.#.#.>.>.#.#...#...###...#...........#.#.....###...#.........###...###...#.#...#...#.........#\n#.#############.#.#.#.#######.#.#############.#.#.###v###.#.#.#.###################.#.#.#######.###.#######.###########.#.#.#.#.#############\n#...........###...#...#...###...#.........#...#...#...###...#...#####.....#.........#...###...#.....#.......#...#...###...#.#.#.............#\n###########.###########.#.#######.#######.#.#######.#################.###.#.###############.#.#######.#######.#.#.#.#######.#.#############.#\n#...........#.........#.#...#...#.......#.#.......#...#.....#.........#...#.........#.......#...#...#.....###.#.#.#.###...#.#...............#\n#.###########.#######.#.###.#.#.#######.#.#######.###.#.###.#.#########.###########.#.#########.#.#.#####.###.#.#.#.###.#.#.#################\n#.........###.#.......#.#...#.#.#...#...#.#...#...###...###...#...#...#.#...........#.....#...#...#.......#...#.#.#...#.#.#.........###.....#\n#########.###.#.#######.#.###.#.#.#.#v###.#.#.#.###############.#.#.#.#.#.###############.#.#.#############.###.#.###.#.#.#########.###.###.#\n#.........#...#.#...#...#...#.#...#.>.>.#...#...###...#.....#...#...#...#.#.......#...###.#.#.#.......###...#...#.#...#.#.###.....#.....#...#\n#.#########.###.#.#.#.#####.#.#######v#.###########.#.#.###.#.###########.#.#####.#.#.###.#.#.#.#####.###.###.###.#.###.#.###v###.#######.###\n#.....#...#...#...#.#.#.....#.#.......#.#...#...#...#...#...#.....#.....#...#.....#.#.###...#...#...#...#...#...#.#...#.#.#.>.###.........###\n#####.#.#.###.#####.#.#.#####.#.#######.#.#.#.#.#.#######.#######.#.###.#####.#####.#.###########.#.###.###.###.#.###.#.#.#.#v###############\n#...#...#.#...#...#.#.#.....#.#.......#...#.#.#.#.....#...#...#...#...#...#...#.....#.....#.......#.....###...#.#...#...#.#.#...#.....#.....#\n#.#.#####.#.###.#.#.#.#####.#.#######.#####.#.#.#####.#.###.#.#v#####.###.#.###.#########.#.#################.#.###.#####.#.###.#.###.#.###.#\n#.#.....#.#.....#.#.#.#.....#...#.....#...#.#.#.#...#.#...#.#.>.>.#...#...#...#.#...#.....#.#...........#...#.#.#...#.....#.###...#...#.#...#\n#.#####.#v#######.#.#.#.#######.#.#####.#.#.#.#.#.#.#.###.#.###v#.#.###.#####.#.#.#.#.#####.#.#########.#.#.#.#.#.###.#####.#######.###.#.###\n#.#...#.#.>.......#...#.........#...#...#.#.#.#.#.#...###...###.#.#.#...#####.#.#.#...#...#...###...#...#.#...#...###...#...###.....#...#...#\n#.#.#.#.#v#########################.#.###.#.#.#.#.#############.#.#.#.#######v#.#.#####.#.#######.#.#.###.#############.#.#####.#####.#####.#\n#...#.#.#...............#...........#.#...#...#.#...#...#.....#.#.#.#.#...#.>.>.#.....#.#.#...#...#.#.###...........###...#...#.......#...#.#\n#####.#.###############.#.###########.#.#######.###.#.#.#.###.#.#.#.#.#.#.#.#v#######.#.#.#.#.#.###.#.#############.#######.#.#########.#.#.#\n#.....#.................#.............#.......#...#...#.#...#...#...#.#.#.#.#.....#...#.#.#.#.#...#.#.#...#...#...#.#.....#.#...........#...#\n#.###########################################.###.#####.###.#########.#.#.#.#####.#.###.#.#.#.###.#.#v#.#.#.#.#.#.#.#.###.#.#################\n#...........#...........#...........#.........###.#.....#...###...###...#.#.#.....#.....#.#.#...#.#.>.>.#...#...#.#.#...#.#.................#\n###########.#.#########.#.#########.#.###########.#.#####.#####.#.#######.#.#.###########.#.###.#.###v###########.#.###.#.#################.#\n#.........#...#.........#.......#...#...........#...#...#.......#.......#.#.#.#...###...#.#.###...###.........###...#...#.....#.............#\n#.#######.#####.###############.#.#############.#####.#.###############.#.#.#.#.#.###.#.#.#.#################.#######.#######.#.#############\n#.......#.#.....#.......###...#.#.#...#.....#...###...#...............#.#.#.#...#.....#.#.#...#...............#.....#.....#...#.............#\n#######.#.#.#####.#####.###.#.#.#.#.#.#.###.#.#####.#################.#.#.#.###########.#.###.#.###############.###.#####.#.###############.#\n#.......#...#...#.#.....#...#...#...#...###.#.#...#.................#...#...###.........#.....#.....#.........#.#...#...#.#...#.............#\n#.###########.#.#.#.#####.#################.#.#.#.#################.###########.###################.#.#######.#.#.###.#.#.###.#.#############\n#.#.........#.#...#.#...#...........#.....#...#.#...#.............#.#.....#.....#...###...###.....#...#.......#.#.###.#.#.#...#.....#.......#\n#.#.#######.#.#####.#.#.###########.#.###.#####.###.#.###########.#.#.###.#.#####.#.###.#.###.###.#####.#######.#.###.#.#.#.#######v#.#####.#\n#...#.......#.....#...#.#...#.....#...#...###...#...#...........#...#...#.#...#...#.#...#...#.#...#.....#.....#.#...#.#.#.#.#...#.>.#.#.....#\n#####.###########.#####.#.#.#.###.#####.#####.###.#############.#######.#.###.#.###.#.#####.#.#.###.#####.###.#.###.#.#.#.#.#.#.#.#v#.#.#####\n#...#...###...###.#.....#.#.#.#...#...#.###...#...#####...#.....###.....#...#.#.#...#.#.....#.#.###.......#...#.#...#.#...#.#.#...#...#.....#\n#.#.###v###.#.###.#.#####.#.#.#.###.#.#v###.###.#######.#.#.#######.#######.#.#.#.###.#.#####.#.###########.###.#.###.#####.#.#############.#\n#.#.###.>...#...#.#...#...#.#.#.#...#.>.>.#.#...#####...#...###...#.....#...#...#.....#.......#.#...###.....###.#.....###...#...#...........#\n#.#.###v#######.#.###.#.###.#.#.#.#####v#.#.#.#######.#########.#.#####.#.#####################.#.#.###.#######.#########.#####.#.###########\n#.#.###...#...#.#.#...#...#.#.#.#.#.....#...#.....#...#.......#.#...#...#.#...#...###...#.......#.#...#...#...#.......#...#.....#.#.........#\n#.#.#####.#.#.#.#.#.#####.#.#.#.#.#.#############.#.###.#####.#.###.#.###.#.#.#.#.###.#.#.#######.###.###.#.#.#######.#.###.#####.#.#######.#\n#.#.......#.#.#...#.......#.#.#.#.#.........#.....#.....###...#.#...#...#.#.#.#.#.###.#.#.###...#.#...###...#.#...#...#...#.#.....#.#.......#\n#.#########.#.#############.#.#.#.#########.#.#############.###.#.#####.#.#.#.#.#.###.#.#v###.#.#.#.#########v#.#.#.#####.#.#.#####.#.#######\n#.#.....#...#...#...###...#.#.#...###.......#.....#...#.....#...#.#.....#.#.#.#.#.#...#.>.>.#.#.#.#...#...#.>.>.#...#.....#.#...#...#...#####\n#.#.###.#.#####.#.#.###.#.#.#.#######.###########.#.#.#.#####.###.#.#####.#.#.#.#.#.#####v#.#.#.#.###.#.#.#.#v#######.#####.###.#.#####.#####\n#.#.###.#.....#...#.....#.#.#.#...#...###...#.....#.#.#.....#...#.#.#...#...#.#.#...###...#.#.#.#...#.#.#.#.#.......#.....#.###.#.....#...###\n#.#.###.#####.###########.#.#.#.#.#.#####.#.#.#####.#.#####v###.#.#.#.#.#####.#.#######.###.#.#.###.#.#.#.#.#######.#####.#.###.#####.###.###\n#.#.#...#...#.#.....#...#.#...#.#.#.......#.#.......#...#.>.>.#.#.#...#...###...###...#...#.#.#.#...#...#...#.......#.....#...#.#...#.###...#\n#.#.#.###.#.#.#.###.#.#.#.#####.#.#########.###########.#.#v#.#.#.#######.#########.#.###.#.#.#.#.###########.#######.#######.#.#.#.#.#####.#\n#.#.#...#.#...#...#...#.#.#.....#.........#.#.....#...#...#.#.#.#...#...#.#...###...#...#.#.#.#.#.#...#.......###...#...#...#.#.#.#...#.....#\n#.#.###.#.#######.#####.#.#.#############.#.#.###.#.#.#####.#.#.###.#.#.#.#.#.###.#####.#.#.#.#.#.#.#.#.#########.#.###.#.#.#.#.#.#####.#####\n#.#.###...###...#.....#.#.#.#...........#.#.#...#...#.......#...###.#.#.#.#.#.#...#...#.#.#...#...#.#.#.......###.#.###...#...#...#...#.....#\n#.#.#########.#.#####.#.#.#.#.#########.#.#.###.###################.#.#.#.#.#.#.###.#.#.#.#########.#.#######.###.#.###############.#.#####.#\n#.#.###.....#.#.......#...#...#.........#...#...#...#...#.....#...#...#...#.#...###.#.#...#...###...#.#...###.....#.......#...#...#.#.......#\n#.#.###.###.#.#################.#############.###.#.#.#.#.###.#.#.#########.#######.#.#####.#.###.###.#.#.###############.#.#.#.#.#.#########\n#.#...#...#...#.........#...###.......#...###.....#.#.#.#.#...#.#...#.......#.....#.#.#...#.#.#...#...#.#...#.............#.#.#.#.#.........#\n#.###.###.#####.#######.#.#.#########.#.#.#########.#.#.#.#.###.###.#.#######.###.#.#.#.#.#.#.#.###.###.###.#.#############.#.#.#.#########.#\n#.#...###.....#.#.......#.#.###...###...#...#...#...#.#.#.#.....#...#.....#...#...#.#.#.#.#.#.#...#.###.#...#.#...#...#...#.#...#.#.........#\n#.#.#########.#.#.#######.#.###.#.#########.#.#.#.###.#.#.#######.#######.#.###.###.#.#.#.#.#.###.#.###.#.###v#.#.#.#.#.#.#.#####.#.#########\n#.#.#.........#.#.###...#.#...#.#.#.....#...#.#.#.....#...#.......#...###...###.#...#...#.#.#...#.#...#.#...>.>.#...#...#.#.#.....#.........#\n#.#.#.#########.#.###.#.#.###.#.#.#.###.#.###.#.###########.#######.#.#########.#.#######.#.###.#.###.#.#################.#.#.#############.#\n#...#.....#...#.#...#.#.#...#.#.#.#...#...#...#.#...###...#.#.....#.#.#.....#...#.......#.#.###.#.###.#.#.................#.#.###...#...#...#\n#########.#.#.#.###.#.#.###.#.#.#.###v#####.###.#.#.###.#.#.#.###.#.#.#.###.#.#########.#.#.###.#.###.#.#.#################.#.###.#.#.#.#v###\n#...#...#...#...#...#.#.#...#.#.#.#.>.>.###.#...#.#.#...#.#.#.#...#.#.#.#...#...#.....#.#.#.#...#...#.#.#...#...#...#...#...#.#...#.#.#.>.###\n#.#.#.#.#########.###.#.#.###.#.#.#.###.###.#.###.#.#.###.#.#.#.###.#.#.#.#####v#.###.#.#.#.#.#####.#.#.###.#.#.#.#.#.#.#.###.#.###.#.###v###\n#.#...#...........#...#...###.#.#...#...#...#...#.#.#.#...#.#.#.#...#.#.#...#.>.>.###...#.#.#...#...#...#...#.#.#.#.#.#.#.###.#...#.#.###...#\n#.#################.#########.#.#####.###.#####.#.#.#.#.###.#.#.#.###.#.###.#.###########.#.###.#.#######.###.#.#.#.#.#.#.###.###.#.#.#####.#\n#.................#.###...#...#.....#...#...#...#.#.#.#.#...#.#...###...###.#.........###.#.#...#.....#...#...#.#.#...#.#.###.#...#.#.#.....#\n#################.#.###.#.#.#######.###.###.#.###.#.#.#.#.###.#############.#########.###.#.#.#######.#.###.###.#.#####.#.###.#.###.#.#.#####\n#.................#.....#.#.#...#...###.#...#...#.#.#.#.#...#...........#...#...#...#...#...#.#.....#.#.#...###...#.....#.#...#...#.#.#.....#\n#.#######################.#.#.#.#.#####.#.#####.#.#.#.#.###v###########.#.###.#.#.#.###.#####.#.###.#.#.#.#########.#####.#.#####.#.#.#####.#\n#...#.......#...#...#...#.#.#.#.#.#.....#...#...#.#.#.#.#.>.>...#...#...#.#...#.#.#.#...#.....#...#.#.#.#.#.........#...#.#...#...#.#.#.....#\n###.#.#####.#.#.#.#.#.#.#.#.#.#.#.#.#######.#.###.#.#.#.#.#####.#.#.#.###.#.###.#.#.#.###.#######.#.#.#.#.#.#########.#.#.###.#.###.#.#.#####\n###...#####...#...#...#...#...#...#.........#.....#...#...#####...#...###...###...#...###.........#...#...#...........#...###...###...#.....#\n###########################################################################################################################################.#`;

function inputToMatrix(input) {
  const data = input.trim().split('\n');
  const rows = data.length;
  const cols = data[0].length;
  const matrix = Array.from({length: rows}, () => Array(cols));
  for (let row = 0; row < rows; row++) {
    for (let col = 0; col < cols; col++) {
      const value = data[row][col];
      matrix[row][col] = {row, col, value};
    }
  }
  return {rows, cols, matrix};
}

// part 1
const slopesDir = new Map([['n', '^'], ['e', '>'], ['s', 'v'], ['w', '<']]);

function isValidRowCol(row, col) {
  return row >= 0 && row < rows && col >= 0 && col < cols;
}

function getNeighbors(row, col, matrix, part2 = false) {
  let neighbors =  [
    {dir: 'n', row: row - 1, col: col},
    {dir: 'e', row: row, col: col + 1},
    {dir: 's', row: row + 1, col: col},
    {dir: 'w', row: row, col: col - 1}
  ].filter(n => isValidRowCol(n.row, n.col));
  if (part2) {
    neighbors = neighbors.filter(n => matrix[n.row][n.col].value != '#');
  } else {
    neighbors = neighbors.filter(n => matrix[n.row][n.col].value == '.' || slopesDir.get(n.dir) == matrix[n.row][n.col].value);
  }
  return neighbors.map(n => matrix[n.row][n.col]);
}

// Depth first search
function dfs(cell, end, visited, matrix) {
  if (cell == end) return 0;
  let max = -Infinity;
  visited.add(cell);
  const neighbors = getNeighbors(cell.row, cell.col, matrix);
  for (const neighbor of neighbors) {
    if (visited.has(neighbor)) continue;
    max = Math.max(max, dfs(neighbor, end, visited, matrix));
  }
  visited.delete(cell);
  return max + 1;
}

const {rows, cols, matrix} = inputToMatrix(input);
const start = matrix[0][1];
const end = matrix[rows - 1][cols - 2];
console.log(dfs(start, end, new Set(), matrix));

// part 2
function key(node) {
  return `${node.row},${node.col}`;
}

function key2(node1, node2) {
  return `${key(node1)},${key(node2)}`;
}

function getDistUntilFirstCrossing(first, second, matrix) {
  let dist = 1;
  let current = second;
  let last = first;
  while (true) {
    const neighbors = getNeighbors(current.row, current.col, matrix, true).filter(n => n != last);
    if (neighbors.length != 1) break;
    last = current;
    current = neighbors[0];
    dist++;
  }
  return {dist, last, crossing: current};
}

function generateGraphFromCrossing(first, second, matrix) {
  const queue = [{first, second}];
  const visited = new Set();
  const graph = new Map();
  while (queue.length > 0) {
    const {first, second} = queue.shift();
    const {dist, last, crossing} = getDistUntilFirstCrossing(first, second, matrix);

    if (!visited.has(key2(first, second))) {
      if (!graph.has(key(first))) graph.set(key(first), []);
      if (!graph.has(key(crossing))) graph.set(key(crossing), []);
      graph.get(key(first)).push({dist, dest: key(crossing)});
      graph.get(key(crossing)).push({dist, dest: key(first)});
      visited.add(key2(first, second));
    }

    getNeighbors(crossing.row, crossing.col, matrix)
      .filter(n => n != last)
      .forEach(second => queue.push({first: crossing, second}));
  }
  return graph;
}

function dfsGraph(nodeKey, endKey, visited, graph) {
  if (nodeKey == endKey) return 0;
  let max = -Infinity;
  visited.add(nodeKey);
  const neighborsData = graph.get(nodeKey);
  for (const {dist, dest: destKey} of neighborsData) {
    if (visited.has(destKey)) continue;
    max = Math.max(max, dfsGraph(destKey, endKey, visited, graph) + dist);
  }
  visited.delete(nodeKey);
  return max;
}

const graph = generateGraphFromCrossing(start, matrix[1][1], matrix);
console.log(dfsGraph(key(start), key(end), new Set(), graph));