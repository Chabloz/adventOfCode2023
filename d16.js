// part 1
const UP = 0;
const RIGHT = 1;
const DOWN = 2;
const LEFT = 3;

function inputToMatrix(input) {
  const data = input.split('\n');
  const rows = data.length;
  const cols = data[0].length;
  const matrix = Array.from({length: rows}, () => Array(cols));
  for (let row = 0; row < rows; row++) {
    for (let col = 0; col < cols; col++) {
      matrix[row][col] = {row, col, value: data[row][col]}
    }
  }
  return matrix;
}

function nextDirEmpty(dir) {
  return [dir];
}

function nextDirMirror1(dir) {
  // \ mirror
  switch (dir) {
    case RIGHT: return [DOWN];
    case LEFT: return [UP];
    case UP: return [LEFT];
    case DOWN: return [RIGHT];
  }
}

function nextDirMirror2(dir) {
  // / mirror
  switch (dir) {
    case RIGHT: return [UP];
    case LEFT: return [DOWN];
    case UP: return [RIGHT];
    case DOWN: return [LEFT];
  }
}

function nextDirHoizontalSplitter(dir) {
  // - splitter
  if (dir == LEFT || dir == RIGHT) return nextDirEmpty(dir);
  return [LEFT, RIGHT];
}

function nextDirVerticalSplitter(dir) {
  // | splitter
  if (dir == UP || dir == DOWN) return nextDirEmpty(dir);
  return [UP, DOWN];
}

function getNextRowCol(dir, tile) {
  switch (dir) {
    case UP: return {row: tile.row - 1, col: tile.col, dir};
    case DOWN: return {row: tile.row + 1, col: tile.col, dir};
    case LEFT: return {row: tile.row, col: tile.col - 1, dir};
    case RIGHT: return {row: tile.row, col: tile.col + 1, dir};
  }
}

function getNextDirections(dir, tileType) {
  switch (tileType) {
    case '.': return nextDirEmpty(dir);
    case '\\': return nextDirMirror1(dir);
    case '/': return nextDirMirror2(dir);
    case '-': return nextDirHoizontalSplitter(dir);
    case '|': return nextDirVerticalSplitter(dir);
  }
}

function isValidRowCol(row, col, matrix) {
  return row >= 0 && row < matrix.length && col >= 0 && col < matrix[0].length;
}

function key(cell) {
  return `${cell.row}:${cell.col}:${cell.dir}`;
}

function bfs(row, col, dir, matrix) {
  const visited = new Set();
  const energized = new Set();
  const frontier = [];
  const cur = {row, col, dir};
  frontier.push(cur);
  visited.add(key(cur));

  while (frontier.length > 0) {
    const cur = frontier.shift();
    // set the tile as energized
    energized.add(key({...cur, dir: 0}));
    const nextDirections = getNextDirections(cur.dir, matrix[cur.row][cur.col].value);
    for (const nextDir of nextDirections) {
      const dest = getNextRowCol(nextDir, matrix[cur.row][cur.col]);
      if (!isValidRowCol(dest.row, dest.col, matrix)) continue;
      if (visited.has(key(dest))) continue;
      frontier.push({row: dest.row, col: dest.col, dir: nextDir});
      visited.add(key(dest));
    }
  }
  return energized.size;
}

const matrix = inputToMatrix(getInput());
console.log(bfs(0, 0, RIGHT, matrix));

// part 2
let maxCountEnergized = -Infinity;
for (let col = 0; col < matrix[0].length; col++) {
  // first row
  maxCountEnergized = Math.max(maxCountEnergized, bfs(0, col, DOWN, matrix));
  // last row
  maxCountEnergized = Math.max(maxCountEnergized, bfs(matrix.length - 1, col, UP, matrix));
}

for (let row = 0; row < matrix.length; row++) {
  // first column
  maxCountEnergized = Math.max(maxCountEnergized, bfs(row, 0, RIGHT, matrix));
  // last column
  maxCountEnergized = Math.max(maxCountEnergized, bfs(row, matrix[0].length - 1, LEFT, matrix));
}
console.log(maxCountEnergized);

function getInput() {
  const input = String.raw`\......../......../.............\..-................||.......|.-./....|.|/................|\...-.......\\..-..
.../.........\................\.-.........\...\........................./\................-......\.........|.-
-\......................../...\........................\....-.....................................|...........
|.../......\......................\/..-...|.\..............-.............../....|..../........|............\..
......../..................-....................././...................\../....................-..............
......|.....\...........|.................\................................................./........\......-.
........\...............-..........................................................\...../.../.-....\...\/....
......|......|.././............/...........................-....................................\.............
.....-......|.................|......................../...../....\..............-.........................|/.
.....\-..|................-....|......\.................|..-..-......................./.....|........-........
......../......................|....|...............|.....-\./...\\.....|...-......................-..-..|....
.................................................../....-.........-...\..............\.........\.....|.......\
/...|............./.\.................................-...\-..............|..........\................||..../.
......|...-.............................................../....../............./..\...........................
-....................................\.../.....................-.../.......\.................-................
....../......\-......|..-..............-.................\....../..\..|..\.............................../....
............../............../.........|.......\./..............|\...-|......../..../....-.........--..../..-.
..\............|..\.................\........|.\......................\../.....-.....//.......................
\.......|......./........-.......||........-..........||..|.............\.\..-......\......../................
...........\.............|...-...........|.\-\...................|...................\.......|................
.........../....\.........-/........\../../.................................\................|/...............
/.....\..\....-.............................|.|..............-....|....-........../........./.................
..|...../....../.....\................./........../.....|.....................-../......./...-.............-..
..-.../............./...-...|.../........|.................---...........-..-......\.......-..................
......./......|..........-........\...........\..-./..........................................\.\.............
................/......................../.|.....\........|.-..|...|.........-.|..-......................\....
.........................-..........||...............-..-...................\..../.............|....\.|.......
.\..........................-....-...-.....................................|............\/............-.|..\/.
...-...............-.........................-..\||.............\..../....../............\.-.....\............
\\......../............................/..........|........................................-....-...|.........
......\|.........\.....-/|................|....-.\......|-.\.........................|...................../..
.\..........-..........................\........../.|.................|/..........|..|.....\....-........../..
/..|.|.|............................/...|..............|.................../...../.\\/...............-..-.....
..\.............|........................................-.................././...........-....\..............
..............................-......../.........../....|.............\.......|.....|.............-...........
....\|.............../................................\.|...../-.............\/.-..../..........-.............
.........|...............\................\........-...\..\............/......./......-............|..|.../...
..../.....-..../...-...\...............|..................|...................................-........\......
.............-...........-...........\....../.....\/......../..........\.................//.-.................
.....................-.|....|...-..........\...........-....-...-......|..............\.|./...................
.../\..|..........\...................|........../..............|\.............\..............|\-........\....
....................-............|............./.|/....-....\....-..................\./...\...\...............
.......................|...|./..............\.\......//...---....\........../..\..\..\..............\|........
....../..................../................../....................../.........|...|............-\............
.|...............-....\../-/............../......\.....-.........................../.../..-.................|.
....../...........\....../.../../......../.......|.........\........-../..-................../............../.
.\...............|.......|............|..........-....|.....\.....-......../.-.........\.-............/.....-.
..................-.......|..................-...\......../|...|....-............../.................././.-...
..............|......\.|/...-.........||.....\....|........-....-........-................../.....-.......\...
..................................-.....|...............................|......../......-........\..\../...|-.
.-..............\....|...................|....|.|........\-............/.../........../.|..................../
............|..............-............\...|..............................................\.||..-.....-......
...................|...........|......./.|..........................................\......-.../.......|.-....
..|..-............-..............\.............|.........\..../..................|............|........-...-|.
.............\......../............................||..-.|............\..........\\.../.../.|..//............/
..............................\../....-..../..|...\.................|\..|........./.................../.......
....................\...............\......\..|..-...........................\........\.../......-....-.......
.......-....................................\..-.............\...\.\.......\............||\./...............-.
.....|..\..........|......\........-...............\..........\..\......../..........\..../.\|.-....-.........
.................\...-........\...|......................./.....\......./......../.....\.-...........-........
............\..-....\.-......-...\../\.-...................|......................\..............-......../...
../......./.....\-.\.................../......\....\...../..-.....\............./...........................|\
.................\../.\..-......................\\....-...............-./-.|...|..|.|../....\..\......-...-...
........|..............|..........\-...../................//.....................................-............
|-....|......../-.\.||............|..........\\.........../....................................../-......./...
-............................../............|\...././..................-.|..........-....-..|......\....|.....
......\.-..../.............\..-............................................-.....\...|...|........|..|........
.....--..|........||.-...///.....................................\......|.................\......../.-..\.....
......\....|.................../../..|/.............|........................-...........|.....\..............
./....-./..|..................\......\.\........./\|........................................./.......-...../..
.....|.......|-............./.|.............-........-................/........................-..|.\.........
../............|......|...........-..........\....|........................../..|............................/
..../...........|...............\.........|...|....|.............\...............-..|.....|.-.-.........\.|...
.............|..|....|...........................\.........||/-..-.\............\.......\../..............|...
.../\......|....//.....................-.../....................../............./|............................
.....-.-......|............\........-.........\.../.\............./....|.....\...-..|......./......\.....\/./.
......\/................../.............../....|.........-................-...|..../........-......./......|..
..-.|...................|...............................\.....................................................
.........\.....-\|.-|.........../..........................................\............./................/...
......|........\..|................\.........../....\........\.................\......\..............\........
\|................/......../.....\..........-..|.......-..............|...-............-................/\...\
\....|.........|........\....\......\...-....../..................\..............\......-.....................
......\.......\....................-......../.|.................|..........\..................|....-|.....|\..
.../.....................\......\.........\.............|.-.........\........\......................\.........
........|......-..../............\\......-..........|...|/..............................|\....|.........\.....
....|........../............/.|..../....................................-.-...............-....-..............
............/......................................|...\..|.......................|.............../...........
......././/......-............................../.........\.-...-........../................/...-........-|...
./....-.|.........|..||.................................\............../.................../.............-....
...-/......./\....../\...|......-...........-...-.....-.-.|........................./................./.......
.........../.....................................\.........|.\............./.......................-.....|../.
..../..-........../.\.........|........................................./......./...............\.............
.....\............./............-..../-...\.\..../....................................../.............-.......
......./........-......-........../.|/.............../.....................-\..............................\..
......../....................-..............-..|.........\..................../........../....|.\.\...........
.........................../.|......................-..............-..............\.......\...................
.-............./|.........\......-.............../.../......\......../....\.............-...\.\.-.....-.......
-............./..--....\\...\..-.|..........-.\-.\./.................||....-.....|.-.../....\.................
.........-|-......-........................-.....\...............-.../.......................-|..|..../.......
.....|....\\........./.\.....|.-.\|........-..../.........../...............\...|.../|......|.................
....-................\...................../.\.\..|....-.|..........................\.....-...|.....\.........
.................................\...........................\.........../.-\............|......-..........\..
/......|............................|....................|...............-..............|.-......./....../....
|...|.........-..-...-.................|................../...|.......................\.......|./.............
...../.....|.....|............................/......-..........\.............\.//............................
..................-.-.\..........-...\..|......-................./...-.....................-..-..\...........\
..................\./-................\....|........................................-|........................
.................\...-.................-........./.......................-..........-................\........
.|../../................/.....|.............|.........................-..............\/..........|...........|
...........-.....\............./.......|.............|...../\-....-...../...\...\..............-|......\.\/.\.`;
return input;
}